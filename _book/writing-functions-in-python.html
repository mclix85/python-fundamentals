<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Writing Functions in Python | Python Fundamenals</title>
<meta name="author" content="Dat Tran">
<meta name="description" content="Shayne Miel Shayne Miel has been building web-scale machine learning applications since 2006. Cycling between leadership roles (Tech Lead, Director, VP) and individual contributor roles at several...">
<meta name="generator" content="bookdown 0.31 with bs4_book()">
<meta property="og:title" content="Writing Functions in Python | Python Fundamenals">
<meta property="og:type" content="book">
<meta property="og:description" content="Shayne Miel Shayne Miel has been building web-scale machine learning applications since 2006. Cycling between leadership roles (Tech Lead, Director, VP) and individual contributor roles at several...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Writing Functions in Python | Python Fundamenals">
<meta name="twitter:description" content="Shayne Miel Shayne Miel has been building web-scale machine learning applications since 2006. Cycling between leadership roles (Tech Lead, Director, VP) and individual contributor roles at several...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Python Fundamenals</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Run the Codes</a></li>
<li class="book-part">Python Fundamentals</li>
<li><a class="" href="introduction-to-python.html">Introduction to Python</a></li>
<li><a class="" href="intermediate-python.html">Intermediate Python</a></li>
<li><a class="" href="python-data-science-toolbox-part-1.html">Python Data Science Toolbox (Part 1)</a></li>
<li><a class="" href="python-data-science-toolbox-part-2.html">Python Data Science Toolbox (Part 2)</a></li>
<li class="book-part">Python programming</li>
<li><a class="" href="writing-efficient-python-code.html">Writing Efficient Python Code</a></li>
<li><a class="active" href="writing-functions-in-python.html">Writing Functions in Python</a></li>
<li><a class="" href="object-oriented-programming-in-python.html">Object-Oriented Programming in Python</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mcllix85/https://github.com/mclix85/python-fundamentals">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="writing-functions-in-python" class="section level1 unnumbered">
<h1>Writing Functions in Python<a class="anchor" aria-label="anchor" href="#writing-functions-in-python"><i class="fas fa-link"></i></a>
</h1>
<p><strong>Shayne Miel</strong></p>
<p class="course__instructor-description display-none-mobile-course-page-experiment">
Shayne Miel has been building web-scale machine learning applications since 2006. Cycling between leadership roles (Tech Lead, Director, VP) and individual contributor roles at several large EdTech companies, he has honed his skills in both data science and engineering. These days you can find him at his standing desk architecting microservice solutions, training deep learning models, or building visualization tools to ensure his and his teammates’ models are performing as desired. In the evenings he stops pretending to be a business professional and follows his true nature: playing board games and building pillow forts with his kids. Follow him on Twitter: <a href="https://twitter.com/ShadyData"><span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;&lt;strong&gt;ShadyData?&lt;/strong&gt;&lt;/p&gt;"><sup>1</sup></a></span></a>
</p>
<p><strong>Course Description</strong></p>
<p class="course__description">
You’ve done your analysis, built your report, and trained a model. What’s next? Well, if you want to deploy your model into production, your code will need to be more reliable than exploratory scripts in a Jupyter notebook. Writing Functions in Python will give you a strong foundation in writing complex and beautiful functions so that you can contribute research and engineering skills to your team. You’ll learn useful tricks, like how to write context managers and decorators. You’ll also learn best practices around how to write maintainable reusable functions with good documentation. They say that people who can do good research and write high-quality code are unicorns. Take this course and discover the magic!
</p>
<div id="best-practices" class="section level2 unnumbered">
<h2>Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"><i class="fas fa-link"></i></a>
</h2>
<p class="chapter__description">
The goal of this course is to transform you into a Python expert, and so the first chapter starts off with best practices when writing functions. You’ll cover docstrings and why they matter and how to know when you need to turn a chunk of code into a function. You will also learn the details of how Python passes arguments to functions, as well as some common gotchas that can cause debugging headaches when calling functions.
</p>
<div id="docstrings" class="section level3 unnumbered">
<h3>Docstrings<a class="anchor" aria-label="anchor" href="#docstrings"><i class="fas fa-link"></i></a>
</h3>
<div id="crafting-a-docstring" class="section level4 unnumbered">
<h4>Crafting a docstring<a class="anchor" aria-label="anchor" href="#crafting-a-docstring"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You’ve decided to write the world’s greatest open-source natural language processing Python package. It will revolutionize working with free-form text, the way <code>numpy</code> did for arrays, <code>pandas</code> did for tabular data, and <code>scikit-learn</code> did for machine learning.
</p>
<p>
The first function you write is <code>count_letter()</code>. It takes a string and a single letter and returns the number of times the letter appears in the string. You want the users of your open-source package to be able to understand how this function works easily, so you will need to give it a docstring. Build up a Google Style docstring for this function by following these steps.
</p>
</div>
<li>
Copy the following string and add it as the docstring for the function: <code>Count the number of times <code>letter</code> appears in <code>content</code>.</code>
</li>
<li>
Now add the arguments section, using the Google style for docstrings. Use <code>str</code> to indicate a string.
</li>
<li>
Add a returns section that informs the user the return value is an <code>int</code>.
</li>
<li>
Finally, add some information about the <code>ValueError</code> that gets raised when the arguments aren’t correct.
</li>
<div>
<div class="sourceCode" id="cb755"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb755-1"><a href="writing-functions-in-python.html#cb755-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_letter(content, letter):</span>
<span id="cb755-2"><a href="writing-functions-in-python.html#cb755-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Count the number of times `letter` appears in `content`.</span></span>
<span id="cb755-3"><a href="writing-functions-in-python.html#cb755-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb755-4"><a href="writing-functions-in-python.html#cb755-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Args:</span></span>
<span id="cb755-5"><a href="writing-functions-in-python.html#cb755-5" aria-hidden="true" tabindex="-1"></a><span class="co">    content (str): The string to search.</span></span>
<span id="cb755-6"><a href="writing-functions-in-python.html#cb755-6" aria-hidden="true" tabindex="-1"></a><span class="co">    letter (str): The letter to search for.</span></span>
<span id="cb755-7"><a href="writing-functions-in-python.html#cb755-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb755-8"><a href="writing-functions-in-python.html#cb755-8" aria-hidden="true" tabindex="-1"></a><span class="co">  Returns:</span></span>
<span id="cb755-9"><a href="writing-functions-in-python.html#cb755-9" aria-hidden="true" tabindex="-1"></a><span class="co">    int</span></span>
<span id="cb755-10"><a href="writing-functions-in-python.html#cb755-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb755-11"><a href="writing-functions-in-python.html#cb755-11" aria-hidden="true" tabindex="-1"></a><span class="co">  # Add a section detailing what errors might be raised</span></span>
<span id="cb755-12"><a href="writing-functions-in-python.html#cb755-12" aria-hidden="true" tabindex="-1"></a><span class="co">  Raises:</span></span>
<span id="cb755-13"><a href="writing-functions-in-python.html#cb755-13" aria-hidden="true" tabindex="-1"></a><span class="co">    ValueError: If `letter` is not a one-character string.</span></span>
<span id="cb755-14"><a href="writing-functions-in-python.html#cb755-14" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb755-15"><a href="writing-functions-in-python.html#cb755-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">not</span> <span class="bu">isinstance</span>(letter, <span class="bu">str</span>)) <span class="kw">or</span> <span class="bu">len</span>(letter) <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb755-16"><a href="writing-functions-in-python.html#cb755-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'`letter` must be a single character string.'</span>)</span>
<span id="cb755-17"><a href="writing-functions-in-python.html#cb755-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">len</span>([char <span class="cf">for</span> char <span class="kw">in</span> content <span class="cf">if</span> char <span class="op">==</span> letter])</span></code></pre></div>
</div>
<p class>
What a delightful docstring! While it does require a bit more typing, the information presented here will make it very easy for others to use this code in the future. Remember that even though computers execute it, code is actually written for humans to read (otherwise you’d just be writing the 1s and 0s that the computer operates on).
</p>
</div>
<div id="retrieving-docstrings" class="section level4 unnumbered">
<h4>Retrieving docstrings<a class="anchor" aria-label="anchor" href="#retrieving-docstrings"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You and a group of friends are working on building an amazing new Python IDE (integrated development environment – like PyCharm, Spyder, Eclipse, Visual Studio, etc.). The team wants to add a feature that displays a tooltip with a function’s docstring whenever the user starts typing the function name. That way, the user doesn’t have to go elsewhere to look up the documentation for the function they are trying to use. You’ve been asked to complete the <code>build_tooltip()</code> function that retrieves a docstring from an arbitrary function.
</p>
<p>
You will be reusing the <code>count_letter()</code> function that you developed in the last exercise to show that we can properly extract its docstring.
</p>
</div>
<div class="exercise--instructions__content">
<p>
Begin by getting the docstring for the function <code>count_letter()</code>. Use an attribute of the <code>count_letter()</code> function.
</p>
</div>
<div>
<div class="sourceCode" id="cb756"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb756-1"><a href="writing-functions-in-python.html#cb756-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the "count_letter" docstring by using an attribute of the function</span></span>
<span id="cb756-2"><a href="writing-functions-in-python.html#cb756-2" aria-hidden="true" tabindex="-1"></a>docstring <span class="op">=</span> count_letter.__doc__</span>
<span id="cb756-3"><a href="writing-functions-in-python.html#cb756-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb756-4"><a href="writing-functions-in-python.html#cb756-4" aria-hidden="true" tabindex="-1"></a>border <span class="op">=</span> <span class="st">'#'</span> <span class="op">*</span> <span class="dv">28</span></span>
<span id="cb756-5"><a href="writing-functions-in-python.html#cb756-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="sc">{}</span><span class="ch">\n</span><span class="sc">{}</span><span class="ch">\n</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(border, docstring, border))</span></code></pre></div>
<pre><code>## ############################
## Count the number of times `letter` appears in `content`.
## 
##   Args:
##     content (str): The string to search.
##     letter (str): The letter to search for.
## 
##   Returns:
##     int
## 
##   # Add a section detailing what errors might be raised
##   Raises:
##     ValueError: If `letter` is not a one-character string.
##   
## ############################</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Now use a function from the <code>inspect</code> module to get a better-formatted version of <code>count_letter()</code>’s docstring.
</p>
</div>
<div>
<div class="sourceCode" id="cb758"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb758-1"><a href="writing-functions-in-python.html#cb758-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> inspect</span>
<span id="cb758-2"><a href="writing-functions-in-python.html#cb758-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-3"><a href="writing-functions-in-python.html#cb758-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the count_letter() function to get its docstring</span></span>
<span id="cb758-4"><a href="writing-functions-in-python.html#cb758-4" aria-hidden="true" tabindex="-1"></a>docstring <span class="op">=</span> inspect.getdoc(count_letter)</span>
<span id="cb758-5"><a href="writing-functions-in-python.html#cb758-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-6"><a href="writing-functions-in-python.html#cb758-6" aria-hidden="true" tabindex="-1"></a>border <span class="op">=</span> <span class="st">'#'</span> <span class="op">*</span> <span class="dv">28</span></span>
<span id="cb758-7"><a href="writing-functions-in-python.html#cb758-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="sc">{}</span><span class="ch">\n</span><span class="sc">{}</span><span class="ch">\n</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(border, docstring, border))</span></code></pre></div>
<pre><code>## ############################
## Count the number of times `letter` appears in `content`.
## 
## Args:
##   content (str): The string to search.
##   letter (str): The letter to search for.
## 
## Returns:
##   int
## 
## # Add a section detailing what errors might be raised
## Raises:
##   ValueError: If `letter` is not a one-character string.
## ############################</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Now create a <code>build_tooltip()</code> function that can extract the docstring from <em>any</em> function that we pass to it.
</p>
</div>
<div>
<div class="sourceCode" id="cb760"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb760-1"><a href="writing-functions-in-python.html#cb760-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> inspect</span>
<span id="cb760-2"><a href="writing-functions-in-python.html#cb760-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb760-3"><a href="writing-functions-in-python.html#cb760-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_tooltip(function):</span>
<span id="cb760-4"><a href="writing-functions-in-python.html#cb760-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Create a tooltip for any function that shows the</span></span>
<span id="cb760-5"><a href="writing-functions-in-python.html#cb760-5" aria-hidden="true" tabindex="-1"></a><span class="co">  function's docstring.</span></span>
<span id="cb760-6"><a href="writing-functions-in-python.html#cb760-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb760-7"><a href="writing-functions-in-python.html#cb760-7" aria-hidden="true" tabindex="-1"></a><span class="co">  Args:</span></span>
<span id="cb760-8"><a href="writing-functions-in-python.html#cb760-8" aria-hidden="true" tabindex="-1"></a><span class="co">    function (callable): The function we want a tooltip for.</span></span>
<span id="cb760-9"><a href="writing-functions-in-python.html#cb760-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb760-10"><a href="writing-functions-in-python.html#cb760-10" aria-hidden="true" tabindex="-1"></a><span class="co">  Returns:</span></span>
<span id="cb760-11"><a href="writing-functions-in-python.html#cb760-11" aria-hidden="true" tabindex="-1"></a><span class="co">    str</span></span>
<span id="cb760-12"><a href="writing-functions-in-python.html#cb760-12" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb760-13"><a href="writing-functions-in-python.html#cb760-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the docstring for the "function" argument by using inspect</span></span>
<span id="cb760-14"><a href="writing-functions-in-python.html#cb760-14" aria-hidden="true" tabindex="-1"></a>  docstring <span class="op">=</span> inspect.getdoc(function)</span>
<span id="cb760-15"><a href="writing-functions-in-python.html#cb760-15" aria-hidden="true" tabindex="-1"></a>  border <span class="op">=</span> <span class="st">'#'</span> <span class="op">*</span> <span class="dv">28</span></span>
<span id="cb760-16"><a href="writing-functions-in-python.html#cb760-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">'</span><span class="sc">{}</span><span class="ch">\n</span><span class="sc">{}</span><span class="ch">\n</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(border, docstring, border)</span>
<span id="cb760-17"><a href="writing-functions-in-python.html#cb760-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb760-18"><a href="writing-functions-in-python.html#cb760-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(build_tooltip(count_letter))</span></code></pre></div>
<pre><code>## ############################
## Count the number of times `letter` appears in `content`.
## 
## Args:
##   content (str): The string to search.
##   letter (str): The letter to search for.
## 
## Returns:
##   int
## 
## # Add a section detailing what errors might be raised
## Raises:
##   ValueError: If `letter` is not a one-character string.
## ############################</code></pre>
<div class="sourceCode" id="cb762"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb762-1"><a href="writing-functions-in-python.html#cb762-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(build_tooltip(<span class="bu">range</span>))</span></code></pre></div>
<pre><code>## ############################
## range(stop) -&gt; range object
## range(start, stop[, step]) -&gt; range object
## 
## Return an object that produces a sequence of integers from start (inclusive)
## to stop (exclusive) by step.  range(i, j) produces i, i+1, i+2, ..., j-1.
## start defaults to 0, and stop is omitted!  range(4) produces 0, 1, 2, 3.
## These are exactly the valid indices for a list of 4 elements.
## When step is given, it specifies the increment (or decrement).
## ############################</code></pre>
<div class="sourceCode" id="cb764"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb764-1"><a href="writing-functions-in-python.html#cb764-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(build_tooltip(<span class="bu">print</span>))</span></code></pre></div>
<pre><code>## ############################
## print(value, ..., sep=' ', end='\n', file=sys.stdout, flush=False)
## 
## Prints the values to a stream, or to sys.stdout by default.
## Optional keyword arguments:
## file:  a file-like object (stream); defaults to the current sys.stdout.
## sep:   string inserted between values, default a space.
## end:   string appended after the last value, default a newline.
## flush: whether to forcibly flush the stream.
## ############################</code></pre>
</div>
<p class>
This IDE is going to be an incredibly delightful experience for your users now! Notice how the <code>count_letter.__doc__</code> version of the docstring had strange whitespace at the beginning of all but the first line. That’s because the docstring is indented to line up visually when reading the code. But when we want to print the docstring, removing those leading spaces with <code>inspect.getdoc()</code> will look much better.
</p>
</div>
<div id="docstrings-to-the-rescue" class="section level4 unnumbered">
<h4>Docstrings to the rescue!<a class="anchor" aria-label="anchor" href="#docstrings-to-the-rescue"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
Some maniac has corrupted your installation of <code>numpy</code>! All of the functions still exist, but they’ve been given random names. You desperately need to call the <code>numpy.histogram()</code> function and you don’t have time to reinstall the package. Fortunately for you, the maniac didn’t think to alter the docstrings, and you know how to access them. <code>numpy</code> has a lot of functions in it, so we’ve narrowed it down to four possible functions that could be <code>numpy.histogram()</code> in disguise: <code>numpy.leyud()</code>, <code>numpy.uqka()</code>, <code>numpy.fywdkxa()</code> or <code>numpy.jinzyxq()</code>.
</p>
<p>
Examine each of these functions’ docstrings in the IPython shell to determine which of them is actually <code>numpy.histogram()</code>.
</p>
</div>
<ul class="task-list">
<li>
<input type="checkbox" disabled><code>numpy.leyud()</code>
</li>
<li>
<input type="checkbox" disabled><code>numpy.uqka()</code>
</li>
<li>
<input type="checkbox" disabled checked><code>numpy.fywdkxa()</code>
</li>
<li>
<input type="checkbox" disabled><code>numpy.jinzyxq()</code>
</li>
</ul>
<p class>
You found it! <code>numpy.fywdkxa()</code> is actually <code>numpy.histogram()</code> in disguise. If you’ve spent any time browsing numpy’s online documentation, you will notice that it is built directly from the docstrings. There are some wonderful tools like <code>sphinx</code> and <code>pydoc</code> that will automatically generate online documentation for you based off of your docstrings.
</p>
</div>
</div>
<div id="dry-and-do-one-thing" class="section level3 unnumbered">
<h3>DRY and "Do One Thing"<a class="anchor" aria-label="anchor" href="#dry-and-do-one-thing"><i class="fas fa-link"></i></a>
</h3>
<div id="extract-a-function" class="section level4 unnumbered">
<h4>Extract a function<a class="anchor" aria-label="anchor" href="#extract-a-function"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
While you were developing a model to predict the likelihood of a student graduating from college, you wrote this bit of code to get the z-scores of students’ yearly GPAs. Now you’re ready to turn it into a production-quality system, so you need to do something about the repetition. Writing a function to calculate the z-scores would improve this code.
</p>
<pre><code># Standardize the GPAs for each year
df['y1_z'] = (df.y1_gpa - df.y1_gpa.mean()) / df.y1_gpa.std()
df['y2_z'] = (df.y2_gpa - df.y2_gpa.mean()) / df.y2_gpa.std()
df['y3_z'] = (df.y3_gpa - df.y3_gpa.mean()) / df.y3_gpa.std()
df['y4_z'] = (df.y4_gpa - df.y4_gpa.mean()) / df.y4_gpa.std()
</code></pre>
<p>
<em>Note: <code>df</code> is a pandas DataFrame where each row is a student with 4 columns of yearly student GPAs: <code>y1_gpa</code>, <code>y2_gpa</code>, <code>y3_gpa</code>, <code>y4_gpa</code></em>
</p>
</div>
<div>
<div class="sourceCode" id="cb766"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb766-1"><a href="writing-functions-in-python.html#cb766-1" aria-hidden="true" tabindex="-1"></a><span class="co"># edited/added</span></span>
<span id="cb766-2"><a href="writing-functions-in-python.html#cb766-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb766-3"><a href="writing-functions-in-python.html#cb766-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"datasets/Writing-Functions-in-Python/students.csv"</span>)</span></code></pre></div>
</div>
<li>
Finish the function so that it returns the z-scores of a column.
</li>
<li>
Use the function to calculate the z-scores for each year (<code>df[‘y1_z’]</code>, <code>df[‘y2_z’]</code>, etc.) from the raw GPA scores (<code>df.y1_gpa</code>, <code>df.y2_gpa</code>, etc.).
</li>
<div>
<div class="sourceCode" id="cb767"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb767-1"><a href="writing-functions-in-python.html#cb767-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> standardize(column):</span>
<span id="cb767-2"><a href="writing-functions-in-python.html#cb767-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Standardize the values in a column.</span></span>
<span id="cb767-3"><a href="writing-functions-in-python.html#cb767-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-4"><a href="writing-functions-in-python.html#cb767-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Args:</span></span>
<span id="cb767-5"><a href="writing-functions-in-python.html#cb767-5" aria-hidden="true" tabindex="-1"></a><span class="co">    column (pandas Series): The data to standardize.</span></span>
<span id="cb767-6"><a href="writing-functions-in-python.html#cb767-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-7"><a href="writing-functions-in-python.html#cb767-7" aria-hidden="true" tabindex="-1"></a><span class="co">  Returns:</span></span>
<span id="cb767-8"><a href="writing-functions-in-python.html#cb767-8" aria-hidden="true" tabindex="-1"></a><span class="co">    pandas Series: the values as z-scores</span></span>
<span id="cb767-9"><a href="writing-functions-in-python.html#cb767-9" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb767-10"><a href="writing-functions-in-python.html#cb767-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Finish the function so that it returns the z-scores</span></span>
<span id="cb767-11"><a href="writing-functions-in-python.html#cb767-11" aria-hidden="true" tabindex="-1"></a>  z_score <span class="op">=</span> (column <span class="op">-</span> column.mean()) <span class="op">/</span> column.std()</span>
<span id="cb767-12"><a href="writing-functions-in-python.html#cb767-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> z_score</span>
<span id="cb767-13"><a href="writing-functions-in-python.html#cb767-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-14"><a href="writing-functions-in-python.html#cb767-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the standardize() function to calculate the z-scores</span></span>
<span id="cb767-15"><a href="writing-functions-in-python.html#cb767-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'y1_z'</span>] <span class="op">=</span> standardize(df.y1_gpa)</span>
<span id="cb767-16"><a href="writing-functions-in-python.html#cb767-16" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'y2_z'</span>] <span class="op">=</span> standardize(df.y2_gpa)</span>
<span id="cb767-17"><a href="writing-functions-in-python.html#cb767-17" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'y3_z'</span>] <span class="op">=</span> standardize(df.y3_gpa)</span>
<span id="cb767-18"><a href="writing-functions-in-python.html#cb767-18" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'y4_z'</span>] <span class="op">=</span> standardize(df.y4_gpa)</span></code></pre></div>
</div>
<p class>
That’s a fantastic function! <code>standardize()</code> will probably be useful in other places in your code, and now it is easy to use, test, and update if you need to. It’s also easier to tell what the code is doing because of the docstring and the name of the function.
</p>
</div>
<div id="split-up-a-function" class="section level4 unnumbered">
<h4>Split up a function<a class="anchor" aria-label="anchor" href="#split-up-a-function"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
Another engineer on your team has written this function to calculate the mean and median of a sorted list. You want to show them how to split it into two simpler functions: <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> and <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>
</p>
<pre><code>def mean_and_median(values):
  """Get the mean and median of a sorted list of `values`

  Args:
    values (iterable of float): A list of numbers

  Returns:
    tuple (float, float): The mean and median
  """
  mean = sum(values) / len(values)
  midpoint = int(len(values) / 2)
  if len(values) % 2 == 0:
    median = (values[midpoint - 1] + values[midpoint]) / 2
  else:
    median = values[midpoint]

  return mean, median
</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Write the <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> function.
</p>
</div>
<div>
<div class="sourceCode" id="cb768"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb768-1"><a href="writing-functions-in-python.html#cb768-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean(values):</span>
<span id="cb768-2"><a href="writing-functions-in-python.html#cb768-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Get the mean of a sorted list of values</span></span>
<span id="cb768-3"><a href="writing-functions-in-python.html#cb768-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb768-4"><a href="writing-functions-in-python.html#cb768-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Args:</span></span>
<span id="cb768-5"><a href="writing-functions-in-python.html#cb768-5" aria-hidden="true" tabindex="-1"></a><span class="co">    values (iterable of float): A list of numbers</span></span>
<span id="cb768-6"><a href="writing-functions-in-python.html#cb768-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb768-7"><a href="writing-functions-in-python.html#cb768-7" aria-hidden="true" tabindex="-1"></a><span class="co">  Returns:</span></span>
<span id="cb768-8"><a href="writing-functions-in-python.html#cb768-8" aria-hidden="true" tabindex="-1"></a><span class="co">    float</span></span>
<span id="cb768-9"><a href="writing-functions-in-python.html#cb768-9" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb768-10"><a href="writing-functions-in-python.html#cb768-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Write the mean() function</span></span>
<span id="cb768-11"><a href="writing-functions-in-python.html#cb768-11" aria-hidden="true" tabindex="-1"></a>  mean <span class="op">=</span> <span class="bu">sum</span>(values) <span class="op">/</span> <span class="bu">len</span>(values)</span>
<span id="cb768-12"><a href="writing-functions-in-python.html#cb768-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> mean</span></code></pre></div>
</div>
<div class="exercise--instructions__content">
<p>
Write the <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code> function.
</p>
</div>
<div>
<div class="sourceCode" id="cb769"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb769-1"><a href="writing-functions-in-python.html#cb769-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> median(values):</span>
<span id="cb769-2"><a href="writing-functions-in-python.html#cb769-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Get the median of a sorted list of values</span></span>
<span id="cb769-3"><a href="writing-functions-in-python.html#cb769-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb769-4"><a href="writing-functions-in-python.html#cb769-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Args:</span></span>
<span id="cb769-5"><a href="writing-functions-in-python.html#cb769-5" aria-hidden="true" tabindex="-1"></a><span class="co">    values (iterable of float): A list of numbers</span></span>
<span id="cb769-6"><a href="writing-functions-in-python.html#cb769-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb769-7"><a href="writing-functions-in-python.html#cb769-7" aria-hidden="true" tabindex="-1"></a><span class="co">  Returns:</span></span>
<span id="cb769-8"><a href="writing-functions-in-python.html#cb769-8" aria-hidden="true" tabindex="-1"></a><span class="co">    float</span></span>
<span id="cb769-9"><a href="writing-functions-in-python.html#cb769-9" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb769-10"><a href="writing-functions-in-python.html#cb769-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Write the median() function</span></span>
<span id="cb769-11"><a href="writing-functions-in-python.html#cb769-11" aria-hidden="true" tabindex="-1"></a>  midpoint <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(values) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb769-12"><a href="writing-functions-in-python.html#cb769-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">len</span>(values) <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb769-13"><a href="writing-functions-in-python.html#cb769-13" aria-hidden="true" tabindex="-1"></a>    median <span class="op">=</span> (values[midpoint <span class="op">-</span> <span class="dv">1</span>] <span class="op">+</span> values[midpoint]) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb769-14"><a href="writing-functions-in-python.html#cb769-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb769-15"><a href="writing-functions-in-python.html#cb769-15" aria-hidden="true" tabindex="-1"></a>    median <span class="op">=</span> values[midpoint]</span>
<span id="cb769-16"><a href="writing-functions-in-python.html#cb769-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> median</span></code></pre></div>
</div>
<p class>
A perfect split! Each function does one thing and does it well. Using, testing, and maintaining these will be a breeze (although you’ll probably just use <code>numpy.mean()</code> and <code>numpy.median()</code> for this in real life).
</p>
</div>
</div>
<div id="pass-by-assignment" class="section level3 unnumbered">
<h3>Pass by assignment<a class="anchor" aria-label="anchor" href="#pass-by-assignment"><i class="fas fa-link"></i></a>
</h3>
<div id="mutable-or-immutable" class="section level4 unnumbered">
<h4>Mutable or immutable?<a class="anchor" aria-label="anchor" href="#mutable-or-immutable"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
The following function adds a mapping between a string and the lowercase version of that string to a dictionary. What do you expect the values of <code>d</code> and <code>s</code> to be after the function is called?
</p>
<pre><code>def store_lower(_dict, _string):
  """Add a mapping between `_string` and a lowercased version of `_string` to `_dict`

  Args:
    _dict (dict): The dictionary to update.
    _string (str): The string to add.
  """
  orig_string = _string
  _string = _string.lower()
  _dict[orig_string] = _string

d = {}
s = 'Hello'

store_lower(d, s)
</code></pre>
</div>
<ul class="task-list">
<li>
<input type="checkbox" disabled><code>d = {}</code>, <code>s = ‘Hello’</code>
</li>
<li>
<input type="checkbox" disabled><code>d = {}</code>, <code>s = ‘hello’</code>
</li>
<li>
<input type="checkbox" disabled checked><code>d = {‘Hello’: ‘hello’}</code>, <code>s = ‘Hello’</code>
</li>
<li>
<input type="checkbox" disabled><code>d = {‘Hello’: ‘hello’}</code>, <code>s = ‘hello’</code>
</li>
<li>
<input type="checkbox" disabled><code>d = {‘hello’: ‘hello’}</code>, <code>s = ‘hello’</code>
</li>
</ul>
<p class="dc-completion-pane__message dc-u-maxw-100pc">
Correct! Dictionaries are mutable objects in Python, so the function can directly change it in the <code>_dict[_orig_string] = _string</code> statement. Strings, on the other hand, are immutable. When the function creates the lowercase version, it has to <em>assign</em> it to the <code>_string</code> variable. This disconnects what happens to <code>_string</code> from the external <code>s</code> variable.
</p>
</div>
<div id="best-practice-for-default-arguments" class="section level4 unnumbered">
<h4>Best practice for default arguments<a class="anchor" aria-label="anchor" href="#best-practice-for-default-arguments"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
One of your co-workers (who obviously didn’t take this course) has written this function for adding a column to a pandas DataFrame. Unfortunately, they used a mutable variable as a default argument value! Please show them a better way to do this so that they don’t get unexpected behavior.
</p>
<pre><code>def add_column(values, df=pandas.DataFrame()):
  """Add a column of `values` to a DataFrame `df`.
  The column will be named "col_&lt;n&gt;" where "n" is
  the numerical index of the column.

  Args:
    values (iterable): The values of the new column
    df (DataFrame, optional): The DataFrame to update.
      If no DataFrame is passed, one is created by default.

  Returns:
    DataFrame
  """
  df['col_{}'.format(len(df.columns))] = values
  return df
</code></pre>
</div>
<li>
Change the default value of <code>df</code> to an immutable value to follow best practices.
</li>
<li>
Update the code of the function so that a new DataFrame is created if the caller didn’t pass one.
</li>
<div>
<div class="sourceCode" id="cb770"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb770-1"><a href="writing-functions-in-python.html#cb770-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use an immutable variable for the default argument</span></span>
<span id="cb770-2"><a href="writing-functions-in-python.html#cb770-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> better_add_column(values, df<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb770-3"><a href="writing-functions-in-python.html#cb770-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Add a column of `values` to a DataFrame `df`.</span></span>
<span id="cb770-4"><a href="writing-functions-in-python.html#cb770-4" aria-hidden="true" tabindex="-1"></a><span class="co">  The column will be named "col_&lt;n&gt;" where "n" is</span></span>
<span id="cb770-5"><a href="writing-functions-in-python.html#cb770-5" aria-hidden="true" tabindex="-1"></a><span class="co">  the numerical index of the column.</span></span>
<span id="cb770-6"><a href="writing-functions-in-python.html#cb770-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb770-7"><a href="writing-functions-in-python.html#cb770-7" aria-hidden="true" tabindex="-1"></a><span class="co">  Args:</span></span>
<span id="cb770-8"><a href="writing-functions-in-python.html#cb770-8" aria-hidden="true" tabindex="-1"></a><span class="co">    values (iterable): The values of the new column</span></span>
<span id="cb770-9"><a href="writing-functions-in-python.html#cb770-9" aria-hidden="true" tabindex="-1"></a><span class="co">    df (DataFrame, optional): The DataFrame to update.</span></span>
<span id="cb770-10"><a href="writing-functions-in-python.html#cb770-10" aria-hidden="true" tabindex="-1"></a><span class="co">      If no DataFrame is passed, one is created by default.</span></span>
<span id="cb770-11"><a href="writing-functions-in-python.html#cb770-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb770-12"><a href="writing-functions-in-python.html#cb770-12" aria-hidden="true" tabindex="-1"></a><span class="co">  Returns:</span></span>
<span id="cb770-13"><a href="writing-functions-in-python.html#cb770-13" aria-hidden="true" tabindex="-1"></a><span class="co">    DataFrame</span></span>
<span id="cb770-14"><a href="writing-functions-in-python.html#cb770-14" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb770-15"><a href="writing-functions-in-python.html#cb770-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update the function to create a default DataFrame</span></span>
<span id="cb770-16"><a href="writing-functions-in-python.html#cb770-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> df <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb770-17"><a href="writing-functions-in-python.html#cb770-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pandas.DataFrame()</span>
<span id="cb770-18"><a href="writing-functions-in-python.html#cb770-18" aria-hidden="true" tabindex="-1"></a>  df[<span class="st">'col_</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(<span class="bu">len</span>(df.columns))] <span class="op">=</span> values</span>
<span id="cb770-19"><a href="writing-functions-in-python.html#cb770-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> df</span></code></pre></div>
</div>
<p class>
Beautiful and best practice! When you need to set a mutable variable as a default argument, always use <code>None</code> and then set the value in the body of the function. This prevents unexpected behavior like adding multiple columns if you call the function more than once.
</p>
</div>
</div>
</div>
<div id="context-managers" class="section level2 unnumbered">
<h2>Context Managers<a class="anchor" aria-label="anchor" href="#context-managers"><i class="fas fa-link"></i></a>
</h2>
<p class="chapter__description">
If you’ve ever seen the “with” keyword in Python and wondered what its deal was, then this is the chapter for you! Context managers are a convenient way to provide connections in Python and guarantee that those connections get cleaned up when you are done using them. This chapter will show you how to use context managers, as well as how to write your own.
</p>
<div id="using-context-managers" class="section level3 unnumbered">
<h3>Using context managers<a class="anchor" aria-label="anchor" href="#using-context-managers"><i class="fas fa-link"></i></a>
</h3>
<div id="the-number-of-cats" class="section level4 unnumbered">
<h4>The number of cats<a class="anchor" aria-label="anchor" href="#the-number-of-cats"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You are working on a natural language processing project to determine what makes great writers so great. Your current hypothesis is that great writers talk about cats <em>a lot</em>. To prove it, you want to count the number of times the word “cat” appears in “Alice’s Adventures in Wonderland” by Lewis Carroll. You have already downloaded a text file, <code>alice.txt</code>, with the entire contents of this great book.
</p>
</div>
<li>
Use the <code><a href="https://rdrr.io/r/base/connections.html">open()</a></code> context manager to open <code>alice.txt</code> and assign the file to the <code>file</code> variable.
</li>
<div>
<div class="sourceCode" id="cb771"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb771-1"><a href="writing-functions-in-python.html#cb771-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open "alice.txt" and assign the file to "file"</span></span>
<span id="cb771-2"><a href="writing-functions-in-python.html#cb771-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'datasets/Writing-Functions-in-Python/alice.txt'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb771-3"><a href="writing-functions-in-python.html#cb771-3" aria-hidden="true" tabindex="-1"></a>  text <span class="op">=</span> <span class="bu">file</span>.read()</span>
<span id="cb771-4"><a href="writing-functions-in-python.html#cb771-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-5"><a href="writing-functions-in-python.html#cb771-5" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb771-6"><a href="writing-functions-in-python.html#cb771-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> word <span class="kw">in</span> text.split():</span>
<span id="cb771-7"><a href="writing-functions-in-python.html#cb771-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> word.lower() <span class="kw">in</span> [<span class="st">'cat'</span>, <span class="st">'cats'</span>]:</span>
<span id="cb771-8"><a href="writing-functions-in-python.html#cb771-8" aria-hidden="true" tabindex="-1"></a>    n <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb771-9"><a href="writing-functions-in-python.html#cb771-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb771-10"><a href="writing-functions-in-python.html#cb771-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Lewis Carroll uses the word "cat" </span><span class="sc">{}</span><span class="st"> times'</span>.<span class="bu">format</span>(n))</span></code></pre></div>
<pre><code>## Lewis Carroll uses the word "cat" 24 times</code></pre>
</div>
<p class>
Cool cat counting! By opening the file using the <code>with open()</code> statement, you were able to read in the text of the file. More importantly, when you were done reading the text, the context manager closed the file for you.
</p>
</div>
<div id="the-speed-of-cats" class="section level4 unnumbered">
<h4>The speed of cats<a class="anchor" aria-label="anchor" href="#the-speed-of-cats"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You’re working on a new web service that processes Instagram feeds to identify which pictures contain cats (don’t ask why – it’s the internet). The code that processes the data is slower than you would like it to be, so you are working on tuning it up to run faster. Given an image, <code>image</code>, you have two functions that can process it:
</p>
<ul>
<li>
<code>process_with_numpy(image)</code>
</li>
<li>
<code>process_with_pytorch(image)</code>
</li>
</ul>
<p>
Your colleague wrote a context manager, <code>timer()</code>, that will print out how long the code inside the context block takes to run. She is suggesting you use it to see which of the two options is faster. Time each function to determine which one to use in your web service.
</p>
</div>
<div>

</div>
<li>
Use the <code>timer()</code> context manager to time how long <code>process_with_numpy(image)</code> takes to run.
</li>
<li>
Use the <code>timer()</code> context manager to time how long <code>process_with_pytorch(image)</code> takes to run.
</li>
<div>
<div class="sourceCode" id="cb773"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb773-1"><a href="writing-functions-in-python.html#cb773-1" aria-hidden="true" tabindex="-1"></a><span class="co"># edited/added</span></span>
<span id="cb773-2"><a href="writing-functions-in-python.html#cb773-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb773-3"><a href="writing-functions-in-python.html#cb773-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb773-4"><a href="writing-functions-in-python.html#cb773-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextlib</span>
<span id="cb773-5"><a href="writing-functions-in-python.html#cb773-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_image_from_instagram():</span>
<span id="cb773-6"><a href="writing-functions-in-python.html#cb773-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> np.random.rand(<span class="dv">84</span>, <span class="dv">84</span>)</span>
<span id="cb773-7"><a href="writing-functions-in-python.html#cb773-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _process_pic(n_sec):</span>
<span id="cb773-8"><a href="writing-functions-in-python.html#cb773-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Processing'</span>, end<span class="op">=</span><span class="st">''</span>, flush<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb773-9"><a href="writing-functions-in-python.html#cb773-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb773-10"><a href="writing-functions-in-python.html#cb773-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'.'</span>, end<span class="op">=</span><span class="st">''</span> <span class="cf">if</span> i <span class="op">&lt;</span> <span class="dv">9</span> <span class="cf">else</span> <span class="st">'done!</span><span class="ch">\n</span><span class="st">'</span>, flush<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb773-11"><a href="writing-functions-in-python.html#cb773-11" aria-hidden="true" tabindex="-1"></a>    time.sleep(n_sec)</span>
<span id="cb773-12"><a href="writing-functions-in-python.html#cb773-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_with_pytorch(p):</span>
<span id="cb773-13"><a href="writing-functions-in-python.html#cb773-13" aria-hidden="true" tabindex="-1"></a>  _process_pic(<span class="fl">0.0328</span>)</span>
<span id="cb773-14"><a href="writing-functions-in-python.html#cb773-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_with_numpy(p):</span>
<span id="cb773-15"><a href="writing-functions-in-python.html#cb773-15" aria-hidden="true" tabindex="-1"></a>  _process_pic(<span class="fl">0.1521</span>)</span>
<span id="cb773-16"><a href="writing-functions-in-python.html#cb773-16" aria-hidden="true" tabindex="-1"></a><span class="at">@contextlib.contextmanager</span></span>
<span id="cb773-17"><a href="writing-functions-in-python.html#cb773-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> timer():</span>
<span id="cb773-18"><a href="writing-functions-in-python.html#cb773-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Time how long code in the context block takes to run."""</span></span>
<span id="cb773-19"><a href="writing-functions-in-python.html#cb773-19" aria-hidden="true" tabindex="-1"></a>  t0 <span class="op">=</span> time.time()</span>
<span id="cb773-20"><a href="writing-functions-in-python.html#cb773-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb773-21"><a href="writing-functions-in-python.html#cb773-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">yield</span></span>
<span id="cb773-22"><a href="writing-functions-in-python.html#cb773-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span>:</span>
<span id="cb773-23"><a href="writing-functions-in-python.html#cb773-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span></span>
<span id="cb773-24"><a href="writing-functions-in-python.html#cb773-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">finally</span>:</span>
<span id="cb773-25"><a href="writing-functions-in-python.html#cb773-25" aria-hidden="true" tabindex="-1"></a>    t1 <span class="op">=</span> time.time()</span>
<span id="cb773-26"><a href="writing-functions-in-python.html#cb773-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Elapsed: </span><span class="sc">{:.2f}</span><span class="st"> seconds'</span>.<span class="bu">format</span>(t1 <span class="op">-</span> t0))</span>
<span id="cb773-27"><a href="writing-functions-in-python.html#cb773-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb773-28"><a href="writing-functions-in-python.html#cb773-28" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> get_image_from_instagram()</span>
<span id="cb773-29"><a href="writing-functions-in-python.html#cb773-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb773-30"><a href="writing-functions-in-python.html#cb773-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Time how long process_with_numpy(image) takes to run</span></span>
<span id="cb773-31"><a href="writing-functions-in-python.html#cb773-31" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> timer():</span>
<span id="cb773-32"><a href="writing-functions-in-python.html#cb773-32" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Numpy version'</span>)</span>
<span id="cb773-33"><a href="writing-functions-in-python.html#cb773-33" aria-hidden="true" tabindex="-1"></a>  process_with_numpy(image)</span></code></pre></div>
<pre><code>## Numpy version
## Processing..........done!
## Elapsed: 1.56 seconds</code></pre>
</div>
<div>
<div class="sourceCode" id="cb775"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb775-1"><a href="writing-functions-in-python.html#cb775-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time how long process_with_pytorch(image) takes to run</span></span>
<span id="cb775-2"><a href="writing-functions-in-python.html#cb775-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> timer():</span>
<span id="cb775-3"><a href="writing-functions-in-python.html#cb775-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Pytorch version'</span>)</span>
<span id="cb775-4"><a href="writing-functions-in-python.html#cb775-4" aria-hidden="true" tabindex="-1"></a>  process_with_pytorch(image)</span></code></pre></div>
<pre><code>## Pytorch version
## Processing..........done!
## Elapsed: 0.36 seconds</code></pre>
</div>
<p class>
Terrific timing! Now that you know the <code>pytorch</code> version is faster, you can use it in your web service to ensure your users get the rapid response time they expect. <br><br> You may have noticed there was no <code>as &lt;variable name&gt;</code> at the end of the <code>with</code> statement in <code>timer()</code> context manager. That is because <code>timer()</code> is a context manager that does not return a value, so the <code>as &lt;variable name&gt;</code> at the end of the <code>with</code> statement isn’t necessary. In the next lesson, you’ll learn how to write your own context managers like <code>timer()</code>.
</p>
</div>
</div>
<div id="writing-context-managers" class="section level3 unnumbered">
<h3>Writing context managers<a class="anchor" aria-label="anchor" href="#writing-context-managers"><i class="fas fa-link"></i></a>
</h3>
<div id="the-timer-context-manager" class="section level4 unnumbered">
<h4>The timer() context manager<a class="anchor" aria-label="anchor" href="#the-timer-context-manager"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
A colleague of yours is working on a web service that processes Instagram photos. Customers are complaining that the service takes too long to identify whether or not an image has a cat in it, so your colleague has come to you for help. You decide to write a context manager that they can use to time how long their functions take to run.
</p>
</div>
<li>
Add a decorator from the <code>contextlib</code> module to the <code>timer()</code> function that will make it act like a context manager.
</li>
<li>
Send control from the <code>timer()</code> function to the context block.
</li>
<div>
<div class="sourceCode" id="cb777"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb777-1"><a href="writing-functions-in-python.html#cb777-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a decorator that will make timer() a context manager</span></span>
<span id="cb777-2"><a href="writing-functions-in-python.html#cb777-2" aria-hidden="true" tabindex="-1"></a><span class="at">@contextlib.contextmanager</span></span>
<span id="cb777-3"><a href="writing-functions-in-python.html#cb777-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> timer():</span>
<span id="cb777-4"><a href="writing-functions-in-python.html#cb777-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Time the execution of a context block.</span></span>
<span id="cb777-5"><a href="writing-functions-in-python.html#cb777-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb777-6"><a href="writing-functions-in-python.html#cb777-6" aria-hidden="true" tabindex="-1"></a><span class="co">  Yields:</span></span>
<span id="cb777-7"><a href="writing-functions-in-python.html#cb777-7" aria-hidden="true" tabindex="-1"></a><span class="co">    None</span></span>
<span id="cb777-8"><a href="writing-functions-in-python.html#cb777-8" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb777-9"><a href="writing-functions-in-python.html#cb777-9" aria-hidden="true" tabindex="-1"></a>  start <span class="op">=</span> time.time()</span>
<span id="cb777-10"><a href="writing-functions-in-python.html#cb777-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Send control back to the context block</span></span>
<span id="cb777-11"><a href="writing-functions-in-python.html#cb777-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">yield</span></span>
<span id="cb777-12"><a href="writing-functions-in-python.html#cb777-12" aria-hidden="true" tabindex="-1"></a>  end <span class="op">=</span> time.time()</span>
<span id="cb777-13"><a href="writing-functions-in-python.html#cb777-13" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Elapsed: </span><span class="sc">{:.2f}</span><span class="st">s'</span>.<span class="bu">format</span>(end <span class="op">-</span> start))</span>
<span id="cb777-14"><a href="writing-functions-in-python.html#cb777-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb777-15"><a href="writing-functions-in-python.html#cb777-15" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> timer():</span>
<span id="cb777-16"><a href="writing-functions-in-python.html#cb777-16" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'This should take approximately 0.25 seconds'</span>)</span>
<span id="cb777-17"><a href="writing-functions-in-python.html#cb777-17" aria-hidden="true" tabindex="-1"></a>  time.sleep(<span class="fl">0.25</span>)</span></code></pre></div>
<pre><code>## This should take approximately 0.25 seconds
## Elapsed: 0.26s</code></pre>
</div>
<p class>
You’re managing context like a boss! And your colleague can now use your <code>timer()</code> context manager to figure out which of their functions is running too slow. Notice that the three elements of a context manager are all here: a function definition, a yield statement, and the <code><span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;&lt;strong&gt;Contextlib.contextmanager?&lt;/strong&gt;&lt;/p&gt;"><sup>2</sup></a></span></code> decorator. It’s also worth noticing that <code>timer()</code> is a context manager that does not return an explicit value, so <code>yield</code> is written by itself without specifying anything to return.
</p>
</div>
<div id="a-read-only-open-context-manager" class="section level4 unnumbered">
<h4>A read-only open() context manager<a class="anchor" aria-label="anchor" href="#a-read-only-open-context-manager"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You have a bunch of data files for your next deep learning project that took you months to collect and clean. It would be <em>terrible</em> if you accidentally overwrote one of those files when trying to read it in for training, so you decide to create a read-only version of the <code><a href="https://rdrr.io/r/base/connections.html">open()</a></code> context manager to use in your project.
</p>
<p>
The regular <code><a href="https://rdrr.io/r/base/connections.html">open()</a></code> context manager:
</p>
<ul>
<li>
takes a filename and a mode (<code>‘r’</code> for read, <code>‘w’</code> for write, or <code>‘a’</code> for append)
</li>
<li>
opens the file for reading, writing, or appending
</li>
<li>
yields control back to the context, along with a reference to the file
</li>
<li>
waits for the context to finish
</li>
<li>
and then closes the file before exiting
</li>
</ul>
<p>
Your context manager will do the same thing, except it will <em>only</em> take the filename as an argument and it will only open the file for reading.
</p>
</div>
<li>
Yield control from <code>open_read_only()</code> to the context block, ensuring that the <code>read_only_file</code> object gets assigned to <code>my_file</code>.
</li>
<li>
Use <code>read_only_file</code>’s <code>.close()</code> method to ensure that you don’t leave open files lying around.
</li>
<div>
<div class="sourceCode" id="cb779"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb779-1"><a href="writing-functions-in-python.html#cb779-1" aria-hidden="true" tabindex="-1"></a><span class="at">@contextlib.contextmanager</span></span>
<span id="cb779-2"><a href="writing-functions-in-python.html#cb779-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> open_read_only(filename):</span>
<span id="cb779-3"><a href="writing-functions-in-python.html#cb779-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Open a file in read-only mode.</span></span>
<span id="cb779-4"><a href="writing-functions-in-python.html#cb779-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb779-5"><a href="writing-functions-in-python.html#cb779-5" aria-hidden="true" tabindex="-1"></a><span class="co">  Args:</span></span>
<span id="cb779-6"><a href="writing-functions-in-python.html#cb779-6" aria-hidden="true" tabindex="-1"></a><span class="co">    filename (str): The location of the file to read</span></span>
<span id="cb779-7"><a href="writing-functions-in-python.html#cb779-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb779-8"><a href="writing-functions-in-python.html#cb779-8" aria-hidden="true" tabindex="-1"></a><span class="co">  Yields:</span></span>
<span id="cb779-9"><a href="writing-functions-in-python.html#cb779-9" aria-hidden="true" tabindex="-1"></a><span class="co">    file object</span></span>
<span id="cb779-10"><a href="writing-functions-in-python.html#cb779-10" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb779-11"><a href="writing-functions-in-python.html#cb779-11" aria-hidden="true" tabindex="-1"></a>  read_only_file <span class="op">=</span> <span class="bu">open</span>(filename, mode<span class="op">=</span><span class="st">'r'</span>)</span>
<span id="cb779-12"><a href="writing-functions-in-python.html#cb779-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Yield read_only_file so it can be assigned to my_file</span></span>
<span id="cb779-13"><a href="writing-functions-in-python.html#cb779-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">yield</span> read_only_file</span>
<span id="cb779-14"><a href="writing-functions-in-python.html#cb779-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Close read_only_file</span></span>
<span id="cb779-15"><a href="writing-functions-in-python.html#cb779-15" aria-hidden="true" tabindex="-1"></a>  read_only_file.close()</span>
<span id="cb779-16"><a href="writing-functions-in-python.html#cb779-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb779-17"><a href="writing-functions-in-python.html#cb779-17" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> open_read_only(<span class="st">'datasets/Writing-Functions-in-Python/my_file.txt'</span>) <span class="im">as</span> my_file:</span>
<span id="cb779-18"><a href="writing-functions-in-python.html#cb779-18" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(my_file.read())</span></code></pre></div>
<pre><code>##     Congratulations! You wrote a context manager that acts like "open()" but operates in read-only mode!</code></pre>
</div>
<p class>
That is a radical read-only context manager! Now you can relax, knowing that every time you use <code>with open_read_only()</code> your files are safe from being accidentally overwritten. This function is an example of a context manager that <em>does</em> return a value, so we write <code>yield read_only_file</code> instead of just <code>yield</code>. Then the <code>read_only_file</code> object gets assigned to <code>my_file</code> in the <code>with</code> statement so that whoever is using your context can call its <code>.read()</code> method in the context block.
</p>
</div>
</div>
<div id="advanced-topics" class="section level3 unnumbered">
<h3>Advanced topics<a class="anchor" aria-label="anchor" href="#advanced-topics"><i class="fas fa-link"></i></a>
</h3>
<div id="context-manager-use-cases" class="section level4 unnumbered">
<h4>Context manager use cases<a class="anchor" aria-label="anchor" href="#context-manager-use-cases"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
Which of the following would <strong>NOT</strong> be a good opportunity to use a context manager?
</p>
</div>
<ul class="task-list">
<li>
<input type="checkbox" disabled>A function that starts a timer that keeps track of how long some block of code takes to run.</li>
<li>
<input type="checkbox" disabled checked>A function that prints all of the prime numbers between 2 and some value <code>n</code>.</li>
<li>
<input type="checkbox" disabled>A function that connects to a smart thermostat so that it can be programmed remotely.</li>
<li>
<input type="checkbox" disabled>A function that prevents multiple users from updating an online spreadsheet at the same time by locking access to the spreadsheet before every operation.</li>
</ul>
<p class="dc-completion-pane__message dc-u-maxw-100pc">
Correct! While you <em>might</em> be able to do this with a context manager, it would make much more sense just to do it with a normal function.
</p>
</div>
<div id="scraping-the-nasdaq" class="section level4 unnumbered">
<h4>Scraping the NASDAQ<a class="anchor" aria-label="anchor" href="#scraping-the-nasdaq"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
Training deep neural nets is expensive! You might as well invest in NVIDIA stock since you’re spending so much on GPUs. To pick the best time to invest, you are going to collect and analyze some data on how their stock is doing. The context manager <code>stock(‘NVDA’)</code> will connect to the NASDAQ and return an object that you can use to get the latest price by calling its <code>.price()</code> method.
</p>
<p>
You want to connect to <code>stock(‘NVDA’)</code> and record 10 timesteps of price data by writing it to the file <code>NVDA.txt</code>.
</p>
<p>
You will notice the use of an underscore when iterating over the for loop. If this is confusing to you, don’t worry. It could easily be replaced with <code>i</code>, if we planned to do something with it, like use it as an index. Since we won’t be using it, we can use a dummy operator, <code>_</code>, which doesn’t use any additional memory.
</p>
</div>
<div>

</div>
<li>
Use the <code>stock(‘NVDA’)</code> context manager and assign the result to <code>nvda</code>.
</li>
<li>
Open a file for writing with <code>open(‘NVDA.txt’, ‘w’)</code> and assign the file object to <code>f_out</code> so you can record the price over time.
</li>
<div>
<div class="sourceCode" id="cb781"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb781-1"><a href="writing-functions-in-python.html#cb781-1" aria-hidden="true" tabindex="-1"></a><span class="co"># edited/added</span></span>
<span id="cb781-2"><a href="writing-functions-in-python.html#cb781-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MockStock:</span>
<span id="cb781-3"><a href="writing-functions-in-python.html#cb781-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, loc, scale):</span>
<span id="cb781-4"><a href="writing-functions-in-python.html#cb781-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.loc <span class="op">=</span> loc</span>
<span id="cb781-5"><a href="writing-functions-in-python.html#cb781-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.scale <span class="op">=</span> scale</span>
<span id="cb781-6"><a href="writing-functions-in-python.html#cb781-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.recent <span class="op">=</span> <span class="bu">list</span>(np.random.laplace(loc, scale, <span class="dv">2</span>))</span>
<span id="cb781-7"><a href="writing-functions-in-python.html#cb781-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> price(<span class="va">self</span>):</span>
<span id="cb781-8"><a href="writing-functions-in-python.html#cb781-8" aria-hidden="true" tabindex="-1"></a>        sign <span class="op">=</span> np.sign(<span class="va">self</span>.recent[<span class="dv">1</span>] <span class="op">-</span> <span class="va">self</span>.recent[<span class="dv">0</span>])</span>
<span id="cb781-9"><a href="writing-functions-in-python.html#cb781-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 70% chance of going same direction</span></span>
<span id="cb781-10"><a href="writing-functions-in-python.html#cb781-10" aria-hidden="true" tabindex="-1"></a>        sign <span class="op">=</span> <span class="dv">1</span> <span class="cf">if</span> sign <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> (sign <span class="cf">if</span> np.random.rand() <span class="op">&gt;</span> <span class="fl">0.3</span> <span class="cf">else</span> <span class="op">-</span><span class="dv">1</span> <span class="op">*</span> sign)</span>
<span id="cb781-11"><a href="writing-functions-in-python.html#cb781-11" aria-hidden="true" tabindex="-1"></a>        new <span class="op">=</span> <span class="va">self</span>.recent[<span class="dv">1</span>] <span class="op">+</span> sign <span class="op">*</span> np.random.rand() <span class="op">/</span> <span class="fl">10.0</span></span>
<span id="cb781-12"><a href="writing-functions-in-python.html#cb781-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.recent <span class="op">=</span> [<span class="va">self</span>.recent[<span class="dv">1</span>], new]</span>
<span id="cb781-13"><a href="writing-functions-in-python.html#cb781-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> new</span>
<span id="cb781-14"><a href="writing-functions-in-python.html#cb781-14" aria-hidden="true" tabindex="-1"></a><span class="at">@contextlib.contextmanager</span></span>
<span id="cb781-15"><a href="writing-functions-in-python.html#cb781-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stock(symbol):</span>
<span id="cb781-16"><a href="writing-functions-in-python.html#cb781-16" aria-hidden="true" tabindex="-1"></a>    base <span class="op">=</span> <span class="fl">140.00</span></span>
<span id="cb781-17"><a href="writing-functions-in-python.html#cb781-17" aria-hidden="true" tabindex="-1"></a>    scale <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb781-18"><a href="writing-functions-in-python.html#cb781-18" aria-hidden="true" tabindex="-1"></a>    mock <span class="op">=</span> MockStock(base, scale)</span>
<span id="cb781-19"><a href="writing-functions-in-python.html#cb781-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Opening stock ticker for </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(symbol))</span>
<span id="cb781-20"><a href="writing-functions-in-python.html#cb781-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">yield</span> mock</span>
<span id="cb781-21"><a href="writing-functions-in-python.html#cb781-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Closing stock ticker'</span>)</span>
<span id="cb781-22"><a href="writing-functions-in-python.html#cb781-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb781-23"><a href="writing-functions-in-python.html#cb781-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the "stock('NVDA')" context manager</span></span>
<span id="cb781-24"><a href="writing-functions-in-python.html#cb781-24" aria-hidden="true" tabindex="-1"></a><span class="co"># and assign the result to the variable "nvda"</span></span>
<span id="cb781-25"><a href="writing-functions-in-python.html#cb781-25" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> stock(<span class="st">'outputs/NVDA'</span>) <span class="im">as</span> nvda:</span>
<span id="cb781-26"><a href="writing-functions-in-python.html#cb781-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Open 'NVDA.txt' for writing as f_out</span></span>
<span id="cb781-27"><a href="writing-functions-in-python.html#cb781-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">with</span> <span class="bu">open</span>(<span class="st">'datasets/Writing-Functions-in-Python/NVDA.txt'</span>, <span class="st">'w'</span>) <span class="im">as</span> f_out:</span>
<span id="cb781-28"><a href="writing-functions-in-python.html#cb781-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb781-29"><a href="writing-functions-in-python.html#cb781-29" aria-hidden="true" tabindex="-1"></a>      value <span class="op">=</span> nvda.price()</span>
<span id="cb781-30"><a href="writing-functions-in-python.html#cb781-30" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">'Logging $</span><span class="sc">{:.2f}</span><span class="st"> for NVDA'</span>.<span class="bu">format</span>(value))</span>
<span id="cb781-31"><a href="writing-functions-in-python.html#cb781-31" aria-hidden="true" tabindex="-1"></a>      f_out.write(<span class="st">'</span><span class="sc">{:.2f}</span><span class="ch">\n</span><span class="st">'</span>.<span class="bu">format</span>(value))</span></code></pre></div>
<pre><code>## Opening stock ticker for outputs/NVDA
## Logging $141.84 for NVDA
## 7
## Logging $141.75 for NVDA
## 7
## Logging $141.68 for NVDA
## 7
## Logging $141.59 for NVDA
## 7
## Logging $141.68 for NVDA
## 7
## Logging $141.66 for NVDA
## 7
## Logging $141.63 for NVDA
## 7
## Logging $141.56 for NVDA
## 7
## Logging $141.57 for NVDA
## 7
## Logging $141.67 for NVDA
## 7
## Closing stock ticker</code></pre>
</div>
<p class>
Super stock scraping! Now you can monitor the NVIDIA stock price and decide when is the exact right time to buy. Nesting context managers like this allows you to connect to the stock market (the <strong>CONNECT/DISCONNECT</strong> pattern) and write to a file (the <strong>OPEN/CLOSE</strong> pattern) at the same time.
</p>
</div>
<div id="changing-the-working-directory" class="section level4 unnumbered">
<h4>Changing the working directory<a class="anchor" aria-label="anchor" href="#changing-the-working-directory"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You are using an open-source library that lets you train deep neural networks on your data. Unfortunately, during training, this library writes out checkpoint models (i.e., models that have been trained on a portion of the data) to the current working directory. You find that behavior frustrating because you don’t want to have to launch the script from the directory where the models will be saved.
</p>
<p>
You decide that one way to fix this is to write a context manager that changes the current working directory, lets you build your models, and then resets the working directory to its original location. You’ll want to be sure that any errors that occur during model training don’t prevent you from resetting the working directory to its original location.
</p>
</div>
<li>
Add a statement that lets you handle any errors that might occur inside the context.
</li>
<li>
Add a statement that ensures <code>os.chdir(current_dir)</code> will be called, whether there was an error or not.
</li>
<div>
<div class="sourceCode" id="cb783"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb783-1"><a href="writing-functions-in-python.html#cb783-1" aria-hidden="true" tabindex="-1"></a><span class="co"># edited/added</span></span>
<span id="cb783-2"><a href="writing-functions-in-python.html#cb783-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb783-3"><a href="writing-functions-in-python.html#cb783-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb783-4"><a href="writing-functions-in-python.html#cb783-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> in_dir(directory):</span>
<span id="cb783-5"><a href="writing-functions-in-python.html#cb783-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Change current working directory to `directory`,</span></span>
<span id="cb783-6"><a href="writing-functions-in-python.html#cb783-6" aria-hidden="true" tabindex="-1"></a><span class="co">  allow the user to run some code, and change back.</span></span>
<span id="cb783-7"><a href="writing-functions-in-python.html#cb783-7" aria-hidden="true" tabindex="-1"></a><span class="co">  Args:</span></span>
<span id="cb783-8"><a href="writing-functions-in-python.html#cb783-8" aria-hidden="true" tabindex="-1"></a><span class="co">    directory (str): The path to a directory to work in.</span></span>
<span id="cb783-9"><a href="writing-functions-in-python.html#cb783-9" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb783-10"><a href="writing-functions-in-python.html#cb783-10" aria-hidden="true" tabindex="-1"></a>  current_dir <span class="op">=</span> os.getcwd()</span>
<span id="cb783-11"><a href="writing-functions-in-python.html#cb783-11" aria-hidden="true" tabindex="-1"></a>  os.chdir(directory)</span>
<span id="cb783-12"><a href="writing-functions-in-python.html#cb783-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add code that lets you handle errors</span></span>
<span id="cb783-13"><a href="writing-functions-in-python.html#cb783-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb783-14"><a href="writing-functions-in-python.html#cb783-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">yield</span></span>
<span id="cb783-15"><a href="writing-functions-in-python.html#cb783-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure the directory is reset,</span></span>
<span id="cb783-16"><a href="writing-functions-in-python.html#cb783-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># whether there was an error or not</span></span>
<span id="cb783-17"><a href="writing-functions-in-python.html#cb783-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">finally</span>:</span>
<span id="cb783-18"><a href="writing-functions-in-python.html#cb783-18" aria-hidden="true" tabindex="-1"></a>    os.chdir(current_dir)</span></code></pre></div>
</div>
<p class>
Excellent error handling! Now, even if someone writes buggy code when using your context manager, you will be sure to change the current working directory back to what it was when they called <code>in_dir()</code>. This is important to do because your users might be relying on their working directory being what it was when they started the script. <code>in_dir()</code> is a great example of the <strong>CHANGE/RESET</strong> pattern that indicates you should use a context manager.
</p>
</div>
</div>
</div>
<div id="decorators" class="section level2 unnumbered">
<h2>Decorators<a class="anchor" aria-label="anchor" href="#decorators"><i class="fas fa-link"></i></a>
</h2>
<p class="chapter__description">
Decorators are an extremely powerful concept in Python. They allow you to modify the behavior of a function without changing the code of the function itself. This chapter will lay the foundational concepts needed to thoroughly understand decorators (functions as objects, scope, and closures), and give you a good introduction into how decorators are used and defined. This deep dive into Python internals will set you up to be a superstar Pythonista.
</p>
<div id="functions-are-objects" class="section level3 unnumbered">
<h3>Functions are objects<a class="anchor" aria-label="anchor" href="#functions-are-objects"><i class="fas fa-link"></i></a>
</h3>
<div id="building-a-command-line-data-app" class="section level4 unnumbered">
<h4>Building a command line data app<a class="anchor" aria-label="anchor" href="#building-a-command-line-data-app"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You are building a command line tool that lets a user interactively explore a dataset. We’ve defined four functions: <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, <code>std()</code>, <code>minimum()</code>, and <code>maximum()</code> that users can call to analyze their data. Help finish this section of the code so that your users can call any of these functions by typing the function name at the input prompt.
</p>
<p>
<strong>Note</strong>: The function <code>get_user_input()</code> in this exercise is a mock version of asking the user to enter a command. It randomly returns one of the four function names. In real life, you would ask for input and wait until the user entered a value.
</p>
</div>
<div>

</div>
<li>
Add the functions <code>std()</code>, <code>minimum()</code>, and <code>maximum()</code> to the <code>function_map</code> dictionary, like we did with <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>.
</li>
<li>
The name of the function the user wants to call is stored in <code>func_name</code>. Use the dictionary of functions, <code>function_map</code>, to call the chosen function and pass <code>data</code> as an argument.
</li>
<div>
<div class="sourceCode" id="cb784"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb784-1"><a href="writing-functions-in-python.html#cb784-1" aria-hidden="true" tabindex="-1"></a><span class="co"># edited/added</span></span>
<span id="cb784-2"><a href="writing-functions-in-python.html#cb784-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb784-3"><a href="writing-functions-in-python.html#cb784-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_user_input(prompt<span class="op">=</span><span class="st">'Type a command: '</span>):</span>
<span id="cb784-4"><a href="writing-functions-in-python.html#cb784-4" aria-hidden="true" tabindex="-1"></a>    command <span class="op">=</span> random.choice([<span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'minimum'</span>, <span class="st">'maximum'</span>])</span>
<span id="cb784-5"><a href="writing-functions-in-python.html#cb784-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(prompt)</span>
<span id="cb784-6"><a href="writing-functions-in-python.html#cb784-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'&gt; </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(command))</span>
<span id="cb784-7"><a href="writing-functions-in-python.html#cb784-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> command</span>
<span id="cb784-8"><a href="writing-functions-in-python.html#cb784-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean(data):</span>
<span id="cb784-9"><a href="writing-functions-in-python.html#cb784-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(data.mean())</span>
<span id="cb784-10"><a href="writing-functions-in-python.html#cb784-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> std(data):</span>
<span id="cb784-11"><a href="writing-functions-in-python.html#cb784-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(data.std())</span>
<span id="cb784-12"><a href="writing-functions-in-python.html#cb784-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> minimum(data):</span>
<span id="cb784-13"><a href="writing-functions-in-python.html#cb784-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(data.<span class="bu">min</span>())</span>
<span id="cb784-14"><a href="writing-functions-in-python.html#cb784-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> maximum(data):</span>
<span id="cb784-15"><a href="writing-functions-in-python.html#cb784-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(data.<span class="bu">max</span>())</span>
<span id="cb784-16"><a href="writing-functions-in-python.html#cb784-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data():</span>
<span id="cb784-17"><a href="writing-functions-in-python.html#cb784-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb784-18"><a href="writing-functions-in-python.html#cb784-18" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'height'</span>] <span class="op">=</span> [<span class="fl">72.1</span>, <span class="fl">69.8</span>, <span class="fl">63.2</span>, <span class="fl">64.7</span>]</span>
<span id="cb784-19"><a href="writing-functions-in-python.html#cb784-19" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'weight'</span>] <span class="op">=</span> [<span class="dv">198</span>, <span class="dv">204</span>, <span class="dv">164</span>, <span class="dv">238</span>]</span>
<span id="cb784-20"><a href="writing-functions-in-python.html#cb784-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb784-21"><a href="writing-functions-in-python.html#cb784-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb784-22"><a href="writing-functions-in-python.html#cb784-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the missing function references to the function map</span></span>
<span id="cb784-23"><a href="writing-functions-in-python.html#cb784-23" aria-hidden="true" tabindex="-1"></a>function_map <span class="op">=</span> {</span>
<span id="cb784-24"><a href="writing-functions-in-python.html#cb784-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">'mean'</span>: mean,</span>
<span id="cb784-25"><a href="writing-functions-in-python.html#cb784-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">'std'</span>: std,</span>
<span id="cb784-26"><a href="writing-functions-in-python.html#cb784-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">'minimum'</span>: minimum,</span>
<span id="cb784-27"><a href="writing-functions-in-python.html#cb784-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">'maximum'</span>: maximum</span>
<span id="cb784-28"><a href="writing-functions-in-python.html#cb784-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb784-29"><a href="writing-functions-in-python.html#cb784-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb784-30"><a href="writing-functions-in-python.html#cb784-30" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> load_data()</span>
<span id="cb784-31"><a href="writing-functions-in-python.html#cb784-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span></code></pre></div>
<pre><code>##    height  weight
## 0    72.1     198
## 1    69.8     204
## 2    63.2     164
## 3    64.7     238</code></pre>
<div class="sourceCode" id="cb786"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb786-1"><a href="writing-functions-in-python.html#cb786-1" aria-hidden="true" tabindex="-1"></a>func_name <span class="op">=</span> get_user_input()</span>
<span id="cb786-2"><a href="writing-functions-in-python.html#cb786-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb786-3"><a href="writing-functions-in-python.html#cb786-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the chosen function and pass "data" as an argument</span></span></code></pre></div>
<pre><code>## Type a command: 
## &gt; mean</code></pre>
<div class="sourceCode" id="cb788"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb788-1"><a href="writing-functions-in-python.html#cb788-1" aria-hidden="true" tabindex="-1"></a>function_map[func_name](data)</span></code></pre></div>
<pre><code>## height     67.45
## weight    201.00
## dtype: float64</code></pre>
</div>
<p class>
Phenomenal function referencing! By adding the functions to a dictionary, you can select the function based on the user’s input. You could have also used a series of if/else statements, but putting them in a dictionary like this is much easier to read and maintain.
</p>
</div>
<div id="reviewing-your-co-workers-code" class="section level4 unnumbered">
<h4>Reviewing your co-worker’s code<a class="anchor" aria-label="anchor" href="#reviewing-your-co-workers-code"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
Your co-worker is asking you to review some code that they’ve written and give them some tips on how to get it ready for production. You know that having a docstring is considered best practice for maintainable, reusable functions, so as a sanity check you decide to run this <code>has_docstring()</code> function on all of their functions.
</p>
<pre><code>def has_docstring(func):
  """Check to see if the function 
  `func` has a docstring.

  Args:
    func (callable): A function.

  Returns:
    bool
  """
  return func.__doc__ is not None
</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Call <code>has_docstring()</code> on your co-worker’s <code>load_and_plot_data()</code> function.
</p>
</div>
<div>
<div class="sourceCode" id="cb790"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb790-1"><a href="writing-functions-in-python.html#cb790-1" aria-hidden="true" tabindex="-1"></a><span class="co"># edited/added</span></span>
<span id="cb790-2"><a href="writing-functions-in-python.html#cb790-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> has_docstring(func):</span>
<span id="cb790-3"><a href="writing-functions-in-python.html#cb790-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Check to see if the function </span></span>
<span id="cb790-4"><a href="writing-functions-in-python.html#cb790-4" aria-hidden="true" tabindex="-1"></a><span class="co">    `func` has a docstring.</span></span>
<span id="cb790-5"><a href="writing-functions-in-python.html#cb790-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb790-6"><a href="writing-functions-in-python.html#cb790-6" aria-hidden="true" tabindex="-1"></a><span class="co">        func (callable): A function.</span></span>
<span id="cb790-7"><a href="writing-functions-in-python.html#cb790-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb790-8"><a href="writing-functions-in-python.html#cb790-8" aria-hidden="true" tabindex="-1"></a><span class="co">        bool</span></span>
<span id="cb790-9"><a href="writing-functions-in-python.html#cb790-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb790-10"><a href="writing-functions-in-python.html#cb790-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> func.__doc__ <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span></span>
<span id="cb790-11"><a href="writing-functions-in-python.html#cb790-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_and_plot_data(filename):</span>
<span id="cb790-12"><a href="writing-functions-in-python.html#cb790-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Load a data frame and plot each column.</span></span>
<span id="cb790-13"><a href="writing-functions-in-python.html#cb790-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb790-14"><a href="writing-functions-in-python.html#cb790-14" aria-hidden="true" tabindex="-1"></a><span class="co">        filename (str): Path to a CSV file of data.</span></span>
<span id="cb790-15"><a href="writing-functions-in-python.html#cb790-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb790-16"><a href="writing-functions-in-python.html#cb790-16" aria-hidden="true" tabindex="-1"></a><span class="co">        pandas.DataFrame</span></span>
<span id="cb790-17"><a href="writing-functions-in-python.html#cb790-17" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb790-18"><a href="writing-functions-in-python.html#cb790-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.load_csv(filename, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb790-19"><a href="writing-functions-in-python.html#cb790-19" aria-hidden="true" tabindex="-1"></a>    df.hist()</span>
<span id="cb790-20"><a href="writing-functions-in-python.html#cb790-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb790-21"><a href="writing-functions-in-python.html#cb790-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb790-22"><a href="writing-functions-in-python.html#cb790-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Call has_docstring() on the load_and_plot_data() function</span></span>
<span id="cb790-23"><a href="writing-functions-in-python.html#cb790-23" aria-hidden="true" tabindex="-1"></a>ok <span class="op">=</span> has_docstring(load_and_plot_data)</span>
<span id="cb790-24"><a href="writing-functions-in-python.html#cb790-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb790-25"><a href="writing-functions-in-python.html#cb790-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> ok:</span>
<span id="cb790-26"><a href="writing-functions-in-python.html#cb790-26" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"load_and_plot_data() doesn't have a docstring!"</span>)</span>
<span id="cb790-27"><a href="writing-functions-in-python.html#cb790-27" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb790-28"><a href="writing-functions-in-python.html#cb790-28" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"load_and_plot_data() looks ok"</span>)</span></code></pre></div>
<pre><code>## load_and_plot_data() looks ok</code></pre>
</div>
<li>
Check if the function <code>as_2D()</code> has a docstring.
</li>
<div>
<div class="sourceCode" id="cb792"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb792-1"><a href="writing-functions-in-python.html#cb792-1" aria-hidden="true" tabindex="-1"></a><span class="co"># edited/added</span></span>
<span id="cb792-2"><a href="writing-functions-in-python.html#cb792-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> as_2D(arr):</span>
<span id="cb792-3"><a href="writing-functions-in-python.html#cb792-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Reshape an array to 2 dimensions"""</span></span>
<span id="cb792-4"><a href="writing-functions-in-python.html#cb792-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(arr).reshape(<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb792-5"><a href="writing-functions-in-python.html#cb792-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb792-6"><a href="writing-functions-in-python.html#cb792-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Call has_docstring() on the as_2D() function</span></span>
<span id="cb792-7"><a href="writing-functions-in-python.html#cb792-7" aria-hidden="true" tabindex="-1"></a>ok <span class="op">=</span> has_docstring(as_2D)</span>
<span id="cb792-8"><a href="writing-functions-in-python.html#cb792-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb792-9"><a href="writing-functions-in-python.html#cb792-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> ok:</span>
<span id="cb792-10"><a href="writing-functions-in-python.html#cb792-10" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"as_2D() doesn't have a docstring!"</span>)</span>
<span id="cb792-11"><a href="writing-functions-in-python.html#cb792-11" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb792-12"><a href="writing-functions-in-python.html#cb792-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"as_2D() looks ok"</span>)</span></code></pre></div>
<pre><code>## as_2D() looks ok</code></pre>
</div>
<li>
Check if the function <code>log_product()</code> has a docstring.
</li>
<div>
<div class="sourceCode" id="cb794"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb794-1"><a href="writing-functions-in-python.html#cb794-1" aria-hidden="true" tabindex="-1"></a><span class="co"># edited/added</span></span>
<span id="cb794-2"><a href="writing-functions-in-python.html#cb794-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_product(arr):</span>
<span id="cb794-3"><a href="writing-functions-in-python.html#cb794-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.exp(np.<span class="bu">sum</span>(np.log(arr)))</span>
<span id="cb794-4"><a href="writing-functions-in-python.html#cb794-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb794-5"><a href="writing-functions-in-python.html#cb794-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call has_docstring() on the log_product() function</span></span>
<span id="cb794-6"><a href="writing-functions-in-python.html#cb794-6" aria-hidden="true" tabindex="-1"></a>ok <span class="op">=</span> has_docstring(log_product)</span>
<span id="cb794-7"><a href="writing-functions-in-python.html#cb794-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb794-8"><a href="writing-functions-in-python.html#cb794-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> ok:</span>
<span id="cb794-9"><a href="writing-functions-in-python.html#cb794-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"log_product() doesn't have a docstring!"</span>)</span>
<span id="cb794-10"><a href="writing-functions-in-python.html#cb794-10" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb794-11"><a href="writing-functions-in-python.html#cb794-11" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"log_product() looks ok"</span>)</span></code></pre></div>
<pre><code>## log_product() doesn't have a docstring!</code></pre>
</div>
<p class>
Awesome job writing functions as arguments! You have discovered that your co-worker forgot to write a docstring for <code>log_product()</code>. You have learned enough about best practices to tell them how to fix it. <br><br> To pass a function as an argument to another function, you had to determine which one you were calling and which one you were referencing. Keeping those straight will be important as we dig deeper into this chapter. From the function names can you think of any other advice you might give your co-worker about their functions?
</p>
</div>
<div id="returning-functions-for-a-math-game" class="section level4 unnumbered">
<h4>Returning functions for a math game<a class="anchor" aria-label="anchor" href="#returning-functions-for-a-math-game"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You are building an educational math game where the player enters a math term, and your program returns a function that matches that term. For instance, if the user types “add”, your program returns a function that adds two numbers. So far you’ve only implemented the “add” function. Now you want to include a “subtract” function.
</p>
</div>
<li>
Define the <code>subtract()</code> function. It should take two arguments and return the first argument minus the second argument.
</li>
<div>
<div class="sourceCode" id="cb796"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb796-1"><a href="writing-functions-in-python.html#cb796-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_math_function(func_name):</span>
<span id="cb796-2"><a href="writing-functions-in-python.html#cb796-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> func_name <span class="op">==</span> <span class="st">'add'</span>:</span>
<span id="cb796-3"><a href="writing-functions-in-python.html#cb796-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add(a, b):</span>
<span id="cb796-4"><a href="writing-functions-in-python.html#cb796-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> a <span class="op">+</span> b</span>
<span id="cb796-5"><a href="writing-functions-in-python.html#cb796-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> add</span>
<span id="cb796-6"><a href="writing-functions-in-python.html#cb796-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">elif</span> func_name <span class="op">==</span> <span class="st">'subtract'</span>:</span>
<span id="cb796-7"><a href="writing-functions-in-python.html#cb796-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the subtract() function</span></span>
<span id="cb796-8"><a href="writing-functions-in-python.html#cb796-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> subtract(a, b):</span>
<span id="cb796-9"><a href="writing-functions-in-python.html#cb796-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> a <span class="op">-</span> b</span>
<span id="cb796-10"><a href="writing-functions-in-python.html#cb796-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> subtract</span>
<span id="cb796-11"><a href="writing-functions-in-python.html#cb796-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb796-12"><a href="writing-functions-in-python.html#cb796-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"I don't know that one"</span>)</span>
<span id="cb796-13"><a href="writing-functions-in-python.html#cb796-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb796-14"><a href="writing-functions-in-python.html#cb796-14" aria-hidden="true" tabindex="-1"></a>add <span class="op">=</span> create_math_function(<span class="st">'add'</span>)</span>
<span id="cb796-15"><a href="writing-functions-in-python.html#cb796-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'5 + 2 = </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(add(<span class="dv">5</span>, <span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## 5 + 2 = 7</code></pre>
<div class="sourceCode" id="cb798"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb798-1"><a href="writing-functions-in-python.html#cb798-1" aria-hidden="true" tabindex="-1"></a>subtract <span class="op">=</span> create_math_function(<span class="st">'subtract'</span>)</span>
<span id="cb798-2"><a href="writing-functions-in-python.html#cb798-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'5 - 2 = </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(subtract(<span class="dv">5</span>, <span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## 5 - 2 = 3</code></pre>
</div>
<p class>
Nice nested function! Now that you’ve implemented the <code>subtract()</code> function, you can keep going to include <code>multiply()</code> and <code>divide()</code>. I predict this game is going to be even bigger than Fortnite! <br><br> Notice how we assign the return value from <code>create_math_function()</code> to the <code>add</code> and <code>subtract</code> variables in the script. Since <code>create_math_function()</code> returns a function, we can then call <em>those variables</em> as functions.
</p>
</div>
</div>
<div id="scope" class="section level3 unnumbered">
<h3>Scope<a class="anchor" aria-label="anchor" href="#scope"><i class="fas fa-link"></i></a>
</h3>
<div id="understanding-scope" class="section level4 unnumbered">
<h4>Understanding scope<a class="anchor" aria-label="anchor" href="#understanding-scope"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
What four values does this script print?
</p>
<pre><code>x = 50

def one():
  x = 10

def two():
  global x
  x = 30

def three():
  x = 100
  print(x)

for func in [one, two, three]:
  func()
  print(x)
</code></pre>
</div>
<ul class="task-list">
<li>
<input type="checkbox" disabled>50, 30, 100, 50</li>
<li>
<input type="checkbox" disabled>10, 30, 30, 30</li>
<li>
<input type="checkbox" disabled checked>50, 30, 100, 30</li>
<li>
<input type="checkbox" disabled>10, 30, 100, 50</li>
<li>
<input type="checkbox" disabled>50, 50, 50, 50</li>
</ul>
<p class="dc-completion-pane__message dc-u-maxw-100pc">
Good job! <code>one()</code> doesn’t change the global <code>x</code>, so the first <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> statement prints <code>50</code>. <br><br><code>two()</code> <em>does</em> change the global <code>x</code> so the second <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> statement prints <code>30</code>. <br><br> The <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> statement inside the function <code>three()</code> is referencing the <code>x</code> value that is local to <code>three()</code>, so it prints <code>100</code>. <br><br> But <code>three()</code> does not change the global <code>x</code> value so the last <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> statement prints <code>30</code> again.
</p>
</div>
<div id="modifying-variables-outside-local-scope" class="section level4 unnumbered">
<h4>Modifying variables outside local scope<a class="anchor" aria-label="anchor" href="#modifying-variables-outside-local-scope"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
Sometimes your functions will need to modify a variable that is outside of the local scope of that function. While it’s generally not best practice to do so, it’s still good to know how in case you need to do it. Update these functions so they can modify variables that would usually be outside of their scope.
</p>
</div>
<div class="exercise--instructions__content">
<p>
Add a keyword that lets us update <code>call_count</code> from inside the function.
</p>
</div>
<div>
<div class="sourceCode" id="cb800"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb800-1"><a href="writing-functions-in-python.html#cb800-1" aria-hidden="true" tabindex="-1"></a>call_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb800-2"><a href="writing-functions-in-python.html#cb800-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb800-3"><a href="writing-functions-in-python.html#cb800-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_function():</span>
<span id="cb800-4"><a href="writing-functions-in-python.html#cb800-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a keyword that lets us update call_count </span></span>
<span id="cb800-5"><a href="writing-functions-in-python.html#cb800-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">global</span> call_count</span>
<span id="cb800-6"><a href="writing-functions-in-python.html#cb800-6" aria-hidden="true" tabindex="-1"></a>  call_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb800-7"><a href="writing-functions-in-python.html#cb800-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb800-8"><a href="writing-functions-in-python.html#cb800-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"You've called my_function() </span><span class="sc">{}</span><span class="st"> times!"</span>.<span class="bu">format</span>(</span>
<span id="cb800-9"><a href="writing-functions-in-python.html#cb800-9" aria-hidden="true" tabindex="-1"></a>    call_count</span>
<span id="cb800-10"><a href="writing-functions-in-python.html#cb800-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb800-11"><a href="writing-functions-in-python.html#cb800-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb800-12"><a href="writing-functions-in-python.html#cb800-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>):</span>
<span id="cb800-13"><a href="writing-functions-in-python.html#cb800-13" aria-hidden="true" tabindex="-1"></a>  my_function()</span></code></pre></div>
<pre><code>## You've called my_function() 1 times!
## You've called my_function() 2 times!
## You've called my_function() 3 times!
## You've called my_function() 4 times!
## You've called my_function() 5 times!
## You've called my_function() 6 times!
## You've called my_function() 7 times!
## You've called my_function() 8 times!
## You've called my_function() 9 times!
## You've called my_function() 10 times!
## You've called my_function() 11 times!
## You've called my_function() 12 times!
## You've called my_function() 13 times!
## You've called my_function() 14 times!
## You've called my_function() 15 times!
## You've called my_function() 16 times!
## You've called my_function() 17 times!
## You've called my_function() 18 times!
## You've called my_function() 19 times!
## You've called my_function() 20 times!</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Add a keyword that lets us modify <code>file_contents</code> from inside <code>save_contents()</code>.
</p>
</div>
<div>
<div class="sourceCode" id="cb802"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb802-1"><a href="writing-functions-in-python.html#cb802-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_files():</span>
<span id="cb802-2"><a href="writing-functions-in-python.html#cb802-2" aria-hidden="true" tabindex="-1"></a>  file_contents <span class="op">=</span> <span class="va">None</span></span>
<span id="cb802-3"><a href="writing-functions-in-python.html#cb802-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb802-4"><a href="writing-functions-in-python.html#cb802-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> save_contents(filename):</span>
<span id="cb802-5"><a href="writing-functions-in-python.html#cb802-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a keyword that lets us modify file_contents</span></span>
<span id="cb802-6"><a href="writing-functions-in-python.html#cb802-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">nonlocal</span> file_contents</span>
<span id="cb802-7"><a href="writing-functions-in-python.html#cb802-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> file_contents <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb802-8"><a href="writing-functions-in-python.html#cb802-8" aria-hidden="true" tabindex="-1"></a>      file_contents <span class="op">=</span> []</span>
<span id="cb802-9"><a href="writing-functions-in-python.html#cb802-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(filename) <span class="im">as</span> fin:</span>
<span id="cb802-10"><a href="writing-functions-in-python.html#cb802-10" aria-hidden="true" tabindex="-1"></a>      file_contents.append(fin.read())</span>
<span id="cb802-11"><a href="writing-functions-in-python.html#cb802-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb802-12"><a href="writing-functions-in-python.html#cb802-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> filename <span class="kw">in</span> [<span class="st">'datasets/Writing-Functions-in-Python/1984.txt'</span>, <span class="st">'datasets/Writing-Functions-in-Python/MobyDick.txt'</span>, <span class="st">'datasets/Writing-Functions-in-Python/CatsEye.txt'</span>]:</span>
<span id="cb802-13"><a href="writing-functions-in-python.html#cb802-13" aria-hidden="true" tabindex="-1"></a>    save_contents(filename)</span>
<span id="cb802-14"><a href="writing-functions-in-python.html#cb802-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb802-15"><a href="writing-functions-in-python.html#cb802-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> file_contents</span>
<span id="cb802-16"><a href="writing-functions-in-python.html#cb802-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb802-17"><a href="writing-functions-in-python.html#cb802-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(read_files()))</span></code></pre></div>
<pre><code>## It was a bright day in April, and the clocks were striking thirteen.
## Call me Ishmael.
## Time is not a line but a dimension, like the dimensions of space.</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Add a keyword to <code>done</code> in <code>check_is_done()</code> so that <code>wait_until_done()</code> eventually stops looping.
</p>
</div>
<div>
<div class="sourceCode" id="cb804"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb804-1"><a href="writing-functions-in-python.html#cb804-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> wait_until_done():</span>
<span id="cb804-2"><a href="writing-functions-in-python.html#cb804-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> check_is_done():</span>
<span id="cb804-3"><a href="writing-functions-in-python.html#cb804-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a keyword so that wait_until_done() </span></span>
<span id="cb804-4"><a href="writing-functions-in-python.html#cb804-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># doesn't run forever</span></span>
<span id="cb804-5"><a href="writing-functions-in-python.html#cb804-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> done</span>
<span id="cb804-6"><a href="writing-functions-in-python.html#cb804-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> random.random() <span class="op">&lt;</span> <span class="fl">0.1</span>:</span>
<span id="cb804-7"><a href="writing-functions-in-python.html#cb804-7" aria-hidden="true" tabindex="-1"></a>      done <span class="op">=</span> <span class="va">True</span></span>
<span id="cb804-8"><a href="writing-functions-in-python.html#cb804-8" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb804-9"><a href="writing-functions-in-python.html#cb804-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> <span class="kw">not</span> done:</span>
<span id="cb804-10"><a href="writing-functions-in-python.html#cb804-10" aria-hidden="true" tabindex="-1"></a>    check_is_done()</span>
<span id="cb804-11"><a href="writing-functions-in-python.html#cb804-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb804-12"><a href="writing-functions-in-python.html#cb804-12" aria-hidden="true" tabindex="-1"></a>done <span class="op">=</span> <span class="va">False</span></span>
<span id="cb804-13"><a href="writing-functions-in-python.html#cb804-13" aria-hidden="true" tabindex="-1"></a>wait_until_done()</span>
<span id="cb804-14"><a href="writing-functions-in-python.html#cb804-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb804-15"><a href="writing-functions-in-python.html#cb804-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Work done? </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(done))</span></code></pre></div>
<pre><code>## Work done? True</code></pre>
</div>
<p class>
Stellar scoping! By adding <code>global done</code> in <code>check_is_done()</code>, you ensure that the <code>done</code> being referenced is the one that was set to <code>False</code> before <code>wait_until_done()</code> was called. Without this keyword, <code>wait_until_done()</code> would loop forever because the <code>done = True</code> in <code>check_is_done()</code> would only be changing a variable that is local to <code>check_is_done()</code>. Understanding what scope your variables are in will help you debug tricky situations like this one.
</p>
</div>
</div>
<div id="closures" class="section level3 unnumbered">
<h3>Closures<a class="anchor" aria-label="anchor" href="#closures"><i class="fas fa-link"></i></a>
</h3>
<div id="checking-for-closure" class="section level4 unnumbered">
<h4>Checking for closure<a class="anchor" aria-label="anchor" href="#checking-for-closure"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You’re teaching your niece how to program in Python, and she is working on returning nested functions. She thinks she has written the code correctly, but she is worried that the returned function won’t have the necessary information when called. Show her that all of the nonlocal variables she needs are in the new function’s closure.
</p>
</div>
<li>
Use an attribute of the <code>my_func()</code> function to show that it has a closure that is not <code>None</code>.
</li>
<div>

</div>
<li>
Show that there are two variables in the closure.
</li>
<div>

</div>
<li>
Get the values of the variables in the closure so you can show that they are equal to <code>[2, 17]</code>, the arguments passed to <code>return_a_func()</code>.
</li>
<div>
<div class="sourceCode" id="cb806"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb806-1"><a href="writing-functions-in-python.html#cb806-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> return_a_func(arg1, arg2):</span>
<span id="cb806-2"><a href="writing-functions-in-python.html#cb806-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> new_func():</span>
<span id="cb806-3"><a href="writing-functions-in-python.html#cb806-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'arg1 was </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(arg1))</span>
<span id="cb806-4"><a href="writing-functions-in-python.html#cb806-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'arg2 was </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(arg2))</span>
<span id="cb806-5"><a href="writing-functions-in-python.html#cb806-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> new_func</span>
<span id="cb806-6"><a href="writing-functions-in-python.html#cb806-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb806-7"><a href="writing-functions-in-python.html#cb806-7" aria-hidden="true" tabindex="-1"></a>my_func <span class="op">=</span> return_a_func(<span class="dv">2</span>, <span class="dv">17</span>)</span>
<span id="cb806-8"><a href="writing-functions-in-python.html#cb806-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-9"><a href="writing-functions-in-python.html#cb806-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show that my_func()'s closure is not None</span></span>
<span id="cb806-10"><a href="writing-functions-in-python.html#cb806-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(my_func.__closure__ <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>)</span></code></pre></div>
<pre><code>## True</code></pre>
</div>
<div>
<div class="sourceCode" id="cb808"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb808-1"><a href="writing-functions-in-python.html#cb808-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show that there are two variables in the closure</span></span>
<span id="cb808-2"><a href="writing-functions-in-python.html#cb808-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(my_func.__closure__) <span class="op">==</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## True</code></pre>
</div>
<div>
<div class="sourceCode" id="cb810"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb810-1"><a href="writing-functions-in-python.html#cb810-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the values of the variables in the closure</span></span>
<span id="cb810-2"><a href="writing-functions-in-python.html#cb810-2" aria-hidden="true" tabindex="-1"></a>closure_values <span class="op">=</span> [</span>
<span id="cb810-3"><a href="writing-functions-in-python.html#cb810-3" aria-hidden="true" tabindex="-1"></a>  my_func.__closure__[i].cell_contents <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>)</span>
<span id="cb810-4"><a href="writing-functions-in-python.html#cb810-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb810-5"><a href="writing-functions-in-python.html#cb810-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(closure_values <span class="op">==</span> [<span class="dv">2</span>, <span class="dv">17</span>])</span></code></pre></div>
<pre><code>## True</code></pre>
</div>
<p class>
Case closed! Your niece is relieved to see that the values she passed to <code>return_a_func()</code> are still accessible to the new function she returned, even after the program has left the scope of <code>return_a_func()</code>. <br><br> Values get added to a function’s closure in the order they are defined in the enclosing function (in this case, <code>arg1</code> and then <code>arg2</code>), but only if they are used in the nested function. That is, if <code>return_a_func()</code> took a third argument (e.g., <code>arg3</code>) that wasn’t used by <code>new_func()</code>, then it would not be captured in <code>new_func()</code>’s closure.
</p>
</div>
<div id="closures-keep-your-values-safe" class="section level4 unnumbered">
<h4>Closures keep your values safe<a class="anchor" aria-label="anchor" href="#closures-keep-your-values-safe"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You are still helping your niece understand closures. You have written the function <code>get_new_func()</code> that returns a nested function. The nested function <code>call_func()</code> calls whatever function was passed to <code>get_new_func()</code>. You’ve also written <code>my_special_function()</code> which simply prints a message that states that you are executing <code>my_special_function()</code>.
</p>
<p>
You want to show your niece that no matter what you do to <code>my_special_function()</code> after passing it to <code>get_new_func()</code>, the new function still mimics the behavior of the original <code>my_special_function()</code> because it is in the new function’s closure.
</p>
</div>
<div class="exercise--instructions__content">
<p>
Show that you still get the original message even if you redefine <code>my_special_function()</code> to only print “hello”.
</p>
</div>
<div>
<div class="sourceCode" id="cb812"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb812-1"><a href="writing-functions-in-python.html#cb812-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_special_function():</span>
<span id="cb812-2"><a href="writing-functions-in-python.html#cb812-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'You are running my_special_function()'</span>)</span>
<span id="cb812-3"><a href="writing-functions-in-python.html#cb812-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb812-4"><a href="writing-functions-in-python.html#cb812-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_new_func(func):</span>
<span id="cb812-5"><a href="writing-functions-in-python.html#cb812-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> call_func():</span>
<span id="cb812-6"><a href="writing-functions-in-python.html#cb812-6" aria-hidden="true" tabindex="-1"></a>    func()</span>
<span id="cb812-7"><a href="writing-functions-in-python.html#cb812-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> call_func</span>
<span id="cb812-8"><a href="writing-functions-in-python.html#cb812-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb812-9"><a href="writing-functions-in-python.html#cb812-9" aria-hidden="true" tabindex="-1"></a>new_func <span class="op">=</span> get_new_func(my_special_function)</span>
<span id="cb812-10"><a href="writing-functions-in-python.html#cb812-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb812-11"><a href="writing-functions-in-python.html#cb812-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Redefine my_special_function() to just print "hello"</span></span>
<span id="cb812-12"><a href="writing-functions-in-python.html#cb812-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_special_function():</span>
<span id="cb812-13"><a href="writing-functions-in-python.html#cb812-13" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"hello"</span>)</span>
<span id="cb812-14"><a href="writing-functions-in-python.html#cb812-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb812-15"><a href="writing-functions-in-python.html#cb812-15" aria-hidden="true" tabindex="-1"></a>new_func()</span></code></pre></div>
<pre><code>## You are running my_special_function()</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Show that even if you delete <code>my_special_function()</code>, you can still call <code>new_func()</code> without any problems.
</p>
</div>
<div>
<div class="sourceCode" id="cb814"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb814-1"><a href="writing-functions-in-python.html#cb814-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_special_function():</span>
<span id="cb814-2"><a href="writing-functions-in-python.html#cb814-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'You are running my_special_function()'</span>)</span>
<span id="cb814-3"><a href="writing-functions-in-python.html#cb814-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb814-4"><a href="writing-functions-in-python.html#cb814-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_new_func(func):</span>
<span id="cb814-5"><a href="writing-functions-in-python.html#cb814-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> call_func():</span>
<span id="cb814-6"><a href="writing-functions-in-python.html#cb814-6" aria-hidden="true" tabindex="-1"></a>    func()</span>
<span id="cb814-7"><a href="writing-functions-in-python.html#cb814-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> call_func</span>
<span id="cb814-8"><a href="writing-functions-in-python.html#cb814-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb814-9"><a href="writing-functions-in-python.html#cb814-9" aria-hidden="true" tabindex="-1"></a>new_func <span class="op">=</span> get_new_func(my_special_function)</span>
<span id="cb814-10"><a href="writing-functions-in-python.html#cb814-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb814-11"><a href="writing-functions-in-python.html#cb814-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete my_special_function()</span></span>
<span id="cb814-12"><a href="writing-functions-in-python.html#cb814-12" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span>(my_special_function)</span>
<span id="cb814-13"><a href="writing-functions-in-python.html#cb814-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb814-14"><a href="writing-functions-in-python.html#cb814-14" aria-hidden="true" tabindex="-1"></a>new_func()</span></code></pre></div>
<pre><code>## You are running my_special_function()</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Show that you still get the original message even if you overwrite <code>my_special_function()</code> with the new function.
</p>
</div>
<div>
<div class="sourceCode" id="cb816"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb816-1"><a href="writing-functions-in-python.html#cb816-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_special_function():</span>
<span id="cb816-2"><a href="writing-functions-in-python.html#cb816-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'You are running my_special_function()'</span>)</span>
<span id="cb816-3"><a href="writing-functions-in-python.html#cb816-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb816-4"><a href="writing-functions-in-python.html#cb816-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_new_func(func):</span>
<span id="cb816-5"><a href="writing-functions-in-python.html#cb816-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> call_func():</span>
<span id="cb816-6"><a href="writing-functions-in-python.html#cb816-6" aria-hidden="true" tabindex="-1"></a>    func()</span>
<span id="cb816-7"><a href="writing-functions-in-python.html#cb816-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> call_func</span>
<span id="cb816-8"><a href="writing-functions-in-python.html#cb816-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb816-9"><a href="writing-functions-in-python.html#cb816-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Overwrite `my_special_function` with the new function</span></span>
<span id="cb816-10"><a href="writing-functions-in-python.html#cb816-10" aria-hidden="true" tabindex="-1"></a>my_special_function <span class="op">=</span> get_new_func(my_special_function)</span>
<span id="cb816-11"><a href="writing-functions-in-python.html#cb816-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb816-12"><a href="writing-functions-in-python.html#cb816-12" aria-hidden="true" tabindex="-1"></a>my_special_function()</span></code></pre></div>
<pre><code>## You are running my_special_function()</code></pre>
</div>
<p class>
Well done! Your niece feels like she understands closures now. She has seen that you can modify, delete, or overwrite the values needed by the nested function, but the nested function can still access those values because they are stored safely in the function’s closure. She even realized that you could run into memory issues if you wound up adding a very large array or object to the closure, and has resolved to keep her eye out for that sort of problem.
</p>
</div>
</div>
<div id="decorators-1" class="section level3 unnumbered">
<h3>Decorators<a class="anchor" aria-label="anchor" href="#decorators-1"><i class="fas fa-link"></i></a>
</h3>
<div id="using-decorator-syntax" class="section level4 unnumbered">
<h4>Using decorator syntax<a class="anchor" aria-label="anchor" href="#using-decorator-syntax"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You have written a decorator called <code>print_args</code> that prints out all of the arguments and their values any time a function that it is decorating gets called.
</p>
</div>
<div class="exercise--instructions__content">
<p>
Decorate <code>my_function()</code> with the <code>print_args()</code> decorator by redefining the <code>my_function</code> variable.
</p>
</div>
<div>
<div class="sourceCode" id="cb818"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb818-1"><a href="writing-functions-in-python.html#cb818-1" aria-hidden="true" tabindex="-1"></a><span class="co"># edited/added</span></span>
<span id="cb818-2"><a href="writing-functions-in-python.html#cb818-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_args(func):</span>
<span id="cb818-3"><a href="writing-functions-in-python.html#cb818-3" aria-hidden="true" tabindex="-1"></a>    sig <span class="op">=</span> inspect.signature(func)</span>
<span id="cb818-4"><a href="writing-functions-in-python.html#cb818-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> wrapper(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb818-5"><a href="writing-functions-in-python.html#cb818-5" aria-hidden="true" tabindex="-1"></a>        bound <span class="op">=</span> sig.bind(<span class="op">*</span>args, <span class="op">**</span>kwargs).arguments</span>
<span id="cb818-6"><a href="writing-functions-in-python.html#cb818-6" aria-hidden="true" tabindex="-1"></a>        str_args <span class="op">=</span> <span class="st">', '</span>.join([<span class="st">'</span><span class="sc">{}</span><span class="st">=</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(k, v) <span class="cf">for</span> k, v <span class="kw">in</span> bound.items()])</span>
<span id="cb818-7"><a href="writing-functions-in-python.html#cb818-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'</span><span class="sc">{}</span><span class="st"> was called with </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(func.<span class="va">__name__</span>, str_args))</span>
<span id="cb818-8"><a href="writing-functions-in-python.html#cb818-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb818-9"><a href="writing-functions-in-python.html#cb818-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> wrapper</span>
<span id="cb818-10"><a href="writing-functions-in-python.html#cb818-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb818-11"><a href="writing-functions-in-python.html#cb818-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_function(a, b, c):</span>
<span id="cb818-12"><a href="writing-functions-in-python.html#cb818-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(a <span class="op">+</span> b <span class="op">+</span> c)</span>
<span id="cb818-13"><a href="writing-functions-in-python.html#cb818-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb818-14"><a href="writing-functions-in-python.html#cb818-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Decorate my_function() with the print_args() decorator</span></span>
<span id="cb818-15"><a href="writing-functions-in-python.html#cb818-15" aria-hidden="true" tabindex="-1"></a>my_function <span class="op">=</span> print_args(my_function)</span>
<span id="cb818-16"><a href="writing-functions-in-python.html#cb818-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb818-17"><a href="writing-functions-in-python.html#cb818-17" aria-hidden="true" tabindex="-1"></a>my_function(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## my_function was called with a=1, b=2, c=3
## 6</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Decorate <code>my_function()</code> with the <code>print_args()</code> decorator using decorator syntax.
</p>
</div>
<div>
<div class="sourceCode" id="cb820"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb820-1"><a href="writing-functions-in-python.html#cb820-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Decorate my_function() with the print_args() decorator</span></span>
<span id="cb820-2"><a href="writing-functions-in-python.html#cb820-2" aria-hidden="true" tabindex="-1"></a><span class="at">@print_args</span></span>
<span id="cb820-3"><a href="writing-functions-in-python.html#cb820-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_function(a, b, c):</span>
<span id="cb820-4"><a href="writing-functions-in-python.html#cb820-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(a <span class="op">+</span> b <span class="op">+</span> c)</span>
<span id="cb820-5"><a href="writing-functions-in-python.html#cb820-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb820-6"><a href="writing-functions-in-python.html#cb820-6" aria-hidden="true" tabindex="-1"></a>my_function(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## my_function was called with a=1, b=2, c=3
## 6</code></pre>
</div>
<p class>
What a delightful decorator! Note that <code><span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;&lt;strong&gt;Print_args?&lt;/strong&gt;&lt;/p&gt;"><sup>3</sup></a></span></code> before the definition of <code>my_function</code> is exactly equivalent to <code>my_function = print_args(my_function)</code>. Remember, even though decorators are functions themselves, when you use decorator syntax with the <code>@</code> symbol you do not include the parentheses after the decorator name.
</p>
</div>
<div id="defining-a-decorator" class="section level4 unnumbered">
<h4>Defining a decorator<a class="anchor" aria-label="anchor" href="#defining-a-decorator"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
Your buddy has been working on a decorator that prints a “before” message before the decorated function is called and prints an “after” message after the decorated function is called. They are having trouble remembering how wrapping the decorated function is supposed to work. Help them out by finishing their <code>print_before_and_after()</code> decorator.
</p>
</div>
<li>
Call the function being decorated and pass it the positional arguments <code>*args</code>.
</li>
<li>
Return the new decorated function.
</li>
<div>
<div class="sourceCode" id="cb822"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb822-1"><a href="writing-functions-in-python.html#cb822-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_before_and_after(func):</span>
<span id="cb822-2"><a href="writing-functions-in-python.html#cb822-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> wrapper(<span class="op">*</span>args):</span>
<span id="cb822-3"><a href="writing-functions-in-python.html#cb822-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Before </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(func.<span class="va">__name__</span>))</span>
<span id="cb822-4"><a href="writing-functions-in-python.html#cb822-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Call the function being decorated with *args</span></span>
<span id="cb822-5"><a href="writing-functions-in-python.html#cb822-5" aria-hidden="true" tabindex="-1"></a>    func(<span class="op">*</span>args)</span>
<span id="cb822-6"><a href="writing-functions-in-python.html#cb822-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'After </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(func.<span class="va">__name__</span>))</span>
<span id="cb822-7"><a href="writing-functions-in-python.html#cb822-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the nested function</span></span>
<span id="cb822-8"><a href="writing-functions-in-python.html#cb822-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper</span>
<span id="cb822-9"><a href="writing-functions-in-python.html#cb822-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb822-10"><a href="writing-functions-in-python.html#cb822-10" aria-hidden="true" tabindex="-1"></a><span class="at">@print_before_and_after</span></span>
<span id="cb822-11"><a href="writing-functions-in-python.html#cb822-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> multiply(a, b):</span>
<span id="cb822-12"><a href="writing-functions-in-python.html#cb822-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(a <span class="op">*</span> b)</span>
<span id="cb822-13"><a href="writing-functions-in-python.html#cb822-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb822-14"><a href="writing-functions-in-python.html#cb822-14" aria-hidden="true" tabindex="-1"></a>multiply(<span class="dv">5</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Before multiply
## 50
## After multiply</code></pre>
</div>
<p class>
What a darling decorator! The decorator <code>print_before_and_after()</code> defines a nested function <code>wrapper()</code> that calls whatever function gets passed to <code>print_before_and_after()</code>. <code>wrapper()</code> adds a little something else to the function call by printing one message before the decorated function is called and another right afterwards. Since <code>print_before_and_after()</code> returns the new <code>wrapper()</code> function, we can use it as a decorator to decorate the <code>multiply()</code> function.
</p>
</div>
</div>
</div>
<div id="more-on-decorators" class="section level2 unnumbered">
<h2>More on Decorators<a class="anchor" aria-label="anchor" href="#more-on-decorators"><i class="fas fa-link"></i></a>
</h2>
<p class="chapter__description">
Now that you understand how decorators work under the hood, this chapter gives you a bunch of real-world examples of when and how you would write decorators in your own code. You will also learn advanced decorator concepts like how to preserve the metadata of your decorated functions and how to write decorators that take arguments.
</p>
<div id="real-world-examples" class="section level3 unnumbered">
<h3>Real-world examples<a class="anchor" aria-label="anchor" href="#real-world-examples"><i class="fas fa-link"></i></a>
</h3>
<div id="print-the-return-type" class="section level4 unnumbered">
<h4>Print the return type<a class="anchor" aria-label="anchor" href="#print-the-return-type"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You are debugging a package that you’ve been working on with your friends. Something weird is happening with the data being returned from one of your functions, but you’re not even sure which function is causing the trouble. You know that sometimes bugs can sneak into your code when you are expecting a function to return one thing, and it returns something different. For instance, if you expect a function to return a numpy array, but it returns a list, you can get unexpected behavior. To ensure this is not what is causing the trouble, you decide to write a decorator, <code>print_return_type()</code>, that will print out the type of the variable that gets returned from every call of any function it is decorating.
</p>
</div>
<li>
Create a nested function, <code>wrapper()</code>, that will become the new decorated function.
</li>
<li>
Call the function being decorated.
</li>
<li>
Return the new decorated function.
</li>
<div>
<div class="sourceCode" id="cb824"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb824-1"><a href="writing-functions-in-python.html#cb824-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_return_type(func):</span>
<span id="cb824-2"><a href="writing-functions-in-python.html#cb824-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define wrapper(), the decorated function</span></span>
<span id="cb824-3"><a href="writing-functions-in-python.html#cb824-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> wrapper(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb824-4"><a href="writing-functions-in-python.html#cb824-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Call the function being decorated</span></span>
<span id="cb824-5"><a href="writing-functions-in-python.html#cb824-5" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb824-6"><a href="writing-functions-in-python.html#cb824-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{}</span><span class="st">() returned type </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(</span>
<span id="cb824-7"><a href="writing-functions-in-python.html#cb824-7" aria-hidden="true" tabindex="-1"></a>      func.<span class="va">__name__</span>, <span class="bu">type</span>(result)</span>
<span id="cb824-8"><a href="writing-functions-in-python.html#cb824-8" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb824-9"><a href="writing-functions-in-python.html#cb824-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb824-10"><a href="writing-functions-in-python.html#cb824-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the decorated function</span></span>
<span id="cb824-11"><a href="writing-functions-in-python.html#cb824-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper</span>
<span id="cb824-12"><a href="writing-functions-in-python.html#cb824-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb824-13"><a href="writing-functions-in-python.html#cb824-13" aria-hidden="true" tabindex="-1"></a><span class="at">@print_return_type</span></span>
<span id="cb824-14"><a href="writing-functions-in-python.html#cb824-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(value):</span>
<span id="cb824-15"><a href="writing-functions-in-python.html#cb824-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> value</span>
<span id="cb824-16"><a href="writing-functions-in-python.html#cb824-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb824-17"><a href="writing-functions-in-python.html#cb824-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(foo(<span class="dv">42</span>))</span></code></pre></div>
<pre><code>## foo() returned type &lt;class 'int'&gt;
## 42</code></pre>
<div class="sourceCode" id="cb826"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb826-1"><a href="writing-functions-in-python.html#cb826-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(foo([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]))</span></code></pre></div>
<pre><code>## foo() returned type &lt;class 'list'&gt;
## [1, 2, 3]</code></pre>
<div class="sourceCode" id="cb828"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb828-1"><a href="writing-functions-in-python.html#cb828-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(foo({<span class="st">'a'</span>: <span class="dv">42</span>}))</span></code></pre></div>
<pre><code>## foo() returned type &lt;class 'dict'&gt;
## {'a': 42}</code></pre>
</div>
<p class>
Righteous return types! Your new decorator helps you examine the results of your functions at runtime. Now you can apply this decorator to every function in the package you are developing and run your scripts. Being able to examine the types of your return values will help you understand what is happening and will hopefully help you find the bug.
</p>
</div>
<div id="counter" class="section level4 unnumbered">
<h4>Counter<a class="anchor" aria-label="anchor" href="#counter"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You’re working on a new web app, and you are curious about how many times each of the functions in it gets called. So you decide to write a decorator that adds a counter to each function that you decorate. You could use this information in the future to determine whether there are sections of code that you could remove because they are no longer being used by the app.
</p>
</div>
<li>
Call the function being decorated and return the result.
</li>
<li>
Return the new decorated function.
</li>
<li>
Decorate <code>foo()</code> with the <code>counter()</code> decorator.
</li>
<div>
<div class="sourceCode" id="cb830"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb830-1"><a href="writing-functions-in-python.html#cb830-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> counter(func):</span>
<span id="cb830-2"><a href="writing-functions-in-python.html#cb830-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> wrapper(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb830-3"><a href="writing-functions-in-python.html#cb830-3" aria-hidden="true" tabindex="-1"></a>    wrapper.count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb830-4"><a href="writing-functions-in-python.html#cb830-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Call the function being decorated and return the result</span></span>
<span id="cb830-5"><a href="writing-functions-in-python.html#cb830-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb830-6"><a href="writing-functions-in-python.html#cb830-6" aria-hidden="true" tabindex="-1"></a>  wrapper.count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb830-7"><a href="writing-functions-in-python.html#cb830-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the new decorated function</span></span>
<span id="cb830-8"><a href="writing-functions-in-python.html#cb830-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper</span>
<span id="cb830-9"><a href="writing-functions-in-python.html#cb830-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb830-10"><a href="writing-functions-in-python.html#cb830-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Decorate foo() with the counter() decorator</span></span>
<span id="cb830-11"><a href="writing-functions-in-python.html#cb830-11" aria-hidden="true" tabindex="-1"></a><span class="at">@counter</span></span>
<span id="cb830-12"><a href="writing-functions-in-python.html#cb830-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo():</span>
<span id="cb830-13"><a href="writing-functions-in-python.html#cb830-13" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'calling foo()'</span>)</span>
<span id="cb830-14"><a href="writing-functions-in-python.html#cb830-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb830-15"><a href="writing-functions-in-python.html#cb830-15" aria-hidden="true" tabindex="-1"></a>foo()</span></code></pre></div>
<pre><code>## calling foo()</code></pre>
<div class="sourceCode" id="cb832"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb832-1"><a href="writing-functions-in-python.html#cb832-1" aria-hidden="true" tabindex="-1"></a>foo()</span></code></pre></div>
<pre><code>## calling foo()</code></pre>
<div class="sourceCode" id="cb834"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb834-1"><a href="writing-functions-in-python.html#cb834-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'foo() was called </span><span class="sc">{}</span><span class="st"> times.'</span>.<span class="bu">format</span>(foo.count))</span></code></pre></div>
<pre><code>## foo() was called 2 times.</code></pre>
</div>
<p class>
Cool counting! Now you can go decorate a bunch of functions with the <code>counter()</code> decorator, let your program run for a while, and then print out how many times each function was called. <br><br> It seems a little magical that you can reference the <code>wrapper()</code> function from <em>inside</em> the definition of <code>wrapper()</code> as we do here on line 3. That’s just one of the many neat things about functions in Python – any function, not just decorators.
</p>
</div>
</div>
<div id="decorators-and-metadata" class="section level3 unnumbered">
<h3>Decorators and metadata<a class="anchor" aria-label="anchor" href="#decorators-and-metadata"><i class="fas fa-link"></i></a>
</h3>
<div id="preserving-docstrings-when-decorating-functions" class="section level4 unnumbered">
<h4>Preserving docstrings when decorating functions<a class="anchor" aria-label="anchor" href="#preserving-docstrings-when-decorating-functions"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
Your friend has come to you with a problem. They’ve written some nifty decorators and added them to the functions in the open-source library they’ve been working on. However, they were running some tests and discovered that all of the docstrings have mysteriously disappeared from their decorated functions. Show your friend how to preserve docstrings and other metadata when writing decorators.
</p>
</div>
<li>
Decorate <code>print_sum()</code> with the <code>add_hello()</code> decorator to replicate the issue that your friend saw - that the docstring disappears.
</li>
<li>
To show your friend that they are printing the <code>wrapper()</code> function’s docstring, not the <code>print_sum()</code> docstring, add the following docstring to <code>wrapper()</code>:
</li>
<li>
Import a function that will allow you to add the metadata from <code>print_sum()</code> to the decorated version of <code>print_sum()</code>.
</li>
<li>
Finally, decorate <code>wrapper()</code> so that the metadata from <code>func()</code> is preserved in the new decorated function.
</li>
<div>
<div class="sourceCode" id="cb836"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb836-1"><a href="writing-functions-in-python.html#cb836-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> wraps</span>
<span id="cb836-2"><a href="writing-functions-in-python.html#cb836-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb836-3"><a href="writing-functions-in-python.html#cb836-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_hello(func):</span>
<span id="cb836-4"><a href="writing-functions-in-python.html#cb836-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Decorate wrapper() so that it keeps func()'s metadata</span></span>
<span id="cb836-5"><a href="writing-functions-in-python.html#cb836-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">@wraps</span>(func)</span>
<span id="cb836-6"><a href="writing-functions-in-python.html#cb836-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> wrapper(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb836-7"><a href="writing-functions-in-python.html#cb836-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Print 'hello' and then call the decorated function."""</span></span>
<span id="cb836-8"><a href="writing-functions-in-python.html#cb836-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Hello'</span>)</span>
<span id="cb836-9"><a href="writing-functions-in-python.html#cb836-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb836-10"><a href="writing-functions-in-python.html#cb836-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper</span>
<span id="cb836-11"><a href="writing-functions-in-python.html#cb836-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb836-12"><a href="writing-functions-in-python.html#cb836-12" aria-hidden="true" tabindex="-1"></a><span class="at">@add_hello</span></span>
<span id="cb836-13"><a href="writing-functions-in-python.html#cb836-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_sum(a, b):</span>
<span id="cb836-14"><a href="writing-functions-in-python.html#cb836-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Adds two numbers and prints the sum"""</span></span>
<span id="cb836-15"><a href="writing-functions-in-python.html#cb836-15" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(a <span class="op">+</span> b)</span>
<span id="cb836-16"><a href="writing-functions-in-python.html#cb836-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb836-17"><a href="writing-functions-in-python.html#cb836-17" aria-hidden="true" tabindex="-1"></a>print_sum(<span class="dv">10</span>, <span class="dv">20</span>)</span></code></pre></div>
<pre><code>## Hello
## 30</code></pre>
<div class="sourceCode" id="cb838"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb838-1"><a href="writing-functions-in-python.html#cb838-1" aria-hidden="true" tabindex="-1"></a>print_sum_docstring <span class="op">=</span> print_sum.__doc__</span>
<span id="cb838-2"><a href="writing-functions-in-python.html#cb838-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(print_sum_docstring)</span></code></pre></div>
<pre><code>## Adds two numbers and prints the sum</code></pre>
</div>
<p class>
That’s a wrap! Your friend was concerned that they couldn’t print the docstrings of their functions. They now realize that the strange behavior they were seeing was caused by the fact that they were accidentally printing the <code>wrapper()</code> docstring instead of the docstring of the original function. After adding <code><span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;&lt;strong&gt;Wraps?&lt;/strong&gt;&lt;/p&gt;"><sup>4</sup></a></span>(func)</code> to all of their decorators, they see that the docstrings are back where they expect them to be.
</p>
</div>
<div id="measuring-decorator-overhead" class="section level4 unnumbered">
<h4>Measuring decorator overhead<a class="anchor" aria-label="anchor" href="#measuring-decorator-overhead"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
Your boss wrote a decorator called <code>check_everything()</code> that they think is amazing, and they are insisting you use it on your function. However, you’ve noticed that when you use it to decorate your functions, it makes them run <em>much</em> slower. You need to convince your boss that the decorator is adding too much processing time to your function. To do this, you are going to measure how long the decorated function takes to run and compare it to how long the undecorated function would have taken to run. This is the decorator in question:
</p>
<pre><code>def check_everything(func):
  @wraps(func)
  def wrapper(*args, **kwargs):
    check_inputs(*args, **kwargs)
    result = func(*args, **kwargs)
    check_outputs(result)
    return result
  return wrapper
</code></pre>
</div>
<div>

</div>
<li>
Call the original function instead of the decorated version by using an attribute of the function that the <code>wraps()</code> statement in your boss’s decorator added to the decorated function.
</li>
<div>
<div class="sourceCode" id="cb840"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb840-1"><a href="writing-functions-in-python.html#cb840-1" aria-hidden="true" tabindex="-1"></a><span class="co"># edited/added</span></span>
<span id="cb840-2"><a href="writing-functions-in-python.html#cb840-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_inputs(a, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb840-3"><a href="writing-functions-in-python.html#cb840-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> value <span class="kw">in</span> a:</span>
<span id="cb840-4"><a href="writing-functions-in-python.html#cb840-4" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb840-5"><a href="writing-functions-in-python.html#cb840-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Finished checking inputs'</span>)</span>
<span id="cb840-6"><a href="writing-functions-in-python.html#cb840-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_outputs(a, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb840-7"><a href="writing-functions-in-python.html#cb840-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> value <span class="kw">in</span> a:</span>
<span id="cb840-8"><a href="writing-functions-in-python.html#cb840-8" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">0.01</span>)</span>
<span id="cb840-9"><a href="writing-functions-in-python.html#cb840-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Finished checking outputs'</span>)</span>
<span id="cb840-10"><a href="writing-functions-in-python.html#cb840-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_everything(func):</span>
<span id="cb840-11"><a href="writing-functions-in-python.html#cb840-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">@wraps</span>(func)</span>
<span id="cb840-12"><a href="writing-functions-in-python.html#cb840-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> wrapper(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb840-13"><a href="writing-functions-in-python.html#cb840-13" aria-hidden="true" tabindex="-1"></a>    check_inputs(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb840-14"><a href="writing-functions-in-python.html#cb840-14" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb840-15"><a href="writing-functions-in-python.html#cb840-15" aria-hidden="true" tabindex="-1"></a>    check_outputs(result)</span>
<span id="cb840-16"><a href="writing-functions-in-python.html#cb840-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb840-17"><a href="writing-functions-in-python.html#cb840-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper</span>
<span id="cb840-18"><a href="writing-functions-in-python.html#cb840-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb840-19"><a href="writing-functions-in-python.html#cb840-19" aria-hidden="true" tabindex="-1"></a><span class="at">@check_everything</span></span>
<span id="cb840-20"><a href="writing-functions-in-python.html#cb840-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> duplicate(my_list):</span>
<span id="cb840-21"><a href="writing-functions-in-python.html#cb840-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Return a new list that repeats the input twice"""</span></span>
<span id="cb840-22"><a href="writing-functions-in-python.html#cb840-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> my_list <span class="op">+</span> my_list</span>
<span id="cb840-23"><a href="writing-functions-in-python.html#cb840-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb840-24"><a href="writing-functions-in-python.html#cb840-24" aria-hidden="true" tabindex="-1"></a>t_start <span class="op">=</span> time.time()</span>
<span id="cb840-25"><a href="writing-functions-in-python.html#cb840-25" aria-hidden="true" tabindex="-1"></a>duplicated_list <span class="op">=</span> duplicate(<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">50</span>)))</span></code></pre></div>
<pre><code>## Finished checking inputs
## Finished checking outputs</code></pre>
<div class="sourceCode" id="cb842"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb842-1"><a href="writing-functions-in-python.html#cb842-1" aria-hidden="true" tabindex="-1"></a>t_end <span class="op">=</span> time.time()</span>
<span id="cb842-2"><a href="writing-functions-in-python.html#cb842-2" aria-hidden="true" tabindex="-1"></a>decorated_time <span class="op">=</span> t_end <span class="op">-</span> t_start</span>
<span id="cb842-3"><a href="writing-functions-in-python.html#cb842-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb842-4"><a href="writing-functions-in-python.html#cb842-4" aria-hidden="true" tabindex="-1"></a>t_start <span class="op">=</span> time.time()</span>
<span id="cb842-5"><a href="writing-functions-in-python.html#cb842-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the original function instead of the decorated one</span></span>
<span id="cb842-6"><a href="writing-functions-in-python.html#cb842-6" aria-hidden="true" tabindex="-1"></a>duplicated_list <span class="op">=</span> duplicate.__wrapped__(<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">50</span>)))</span>
<span id="cb842-7"><a href="writing-functions-in-python.html#cb842-7" aria-hidden="true" tabindex="-1"></a>t_end <span class="op">=</span> time.time()</span>
<span id="cb842-8"><a href="writing-functions-in-python.html#cb842-8" aria-hidden="true" tabindex="-1"></a>undecorated_time <span class="op">=</span> t_end <span class="op">-</span> t_start</span>
<span id="cb842-9"><a href="writing-functions-in-python.html#cb842-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb842-10"><a href="writing-functions-in-python.html#cb842-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Decorated time: </span><span class="sc">{:.5f}</span><span class="st">s'</span>.<span class="bu">format</span>(decorated_time))</span></code></pre></div>
<pre><code>## Decorated time: 1.85666s</code></pre>
<div class="sourceCode" id="cb844"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb844-1"><a href="writing-functions-in-python.html#cb844-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Undecorated time: </span><span class="sc">{:.5f}</span><span class="st">s'</span>.<span class="bu">format</span>(undecorated_time))</span></code></pre></div>
<pre><code>## Undecorated time: 0.00906s</code></pre>
</div>
<p class>
Wow! Your function ran approximately 10,000 times faster without your boss’s decorator. At least they were smart enough to add <code><span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;&lt;strong&gt;Wraps?&lt;/strong&gt;&lt;/p&gt;"><sup>5</sup></a></span>(func)</code> to the nested <code>wrapper()</code> function so that you were able to access the original function. You should show them the results of this test. Be sure to ask for a raise while you’re at it!
</p>
</div>
</div>
<div id="decorators-that-take-arguments" class="section level3 unnumbered">
<h3>Decorators that take arguments<a class="anchor" aria-label="anchor" href="#decorators-that-take-arguments"><i class="fas fa-link"></i></a>
</h3>
<div id="run_n_times" class="section level4 unnumbered">
<h4>Run_n_times()<a class="anchor" aria-label="anchor" href="#run_n_times"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
In the video exercise, I showed you an example of a decorator that takes an argument: <code>run_n_times()</code>. The code for that decorator is repeated below to remind you how it works. Practice different ways of applying the decorator to the function <code>print_sum()</code>. Then I’ll show you a funny prank you can play on your co-workers.
</p>
<pre><code>def run_n_times(n):
  """Define and return a decorator"""
  def decorator(func):
    def wrapper(*args, **kwargs):
      for i in range(n):
        func(*args, **kwargs)
    return wrapper
  return decorator
</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Add the <code>run_n_times()</code> decorator to <code>print_sum()</code> using decorator syntax so that <code>print_sum()</code> runs 10 times.
</p>
</div>
<div>
<div class="sourceCode" id="cb846"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb846-1"><a href="writing-functions-in-python.html#cb846-1" aria-hidden="true" tabindex="-1"></a><span class="co"># edited/added</span></span>
<span id="cb846-2"><a href="writing-functions-in-python.html#cb846-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_n_times(n):</span>
<span id="cb846-3"><a href="writing-functions-in-python.html#cb846-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Define and return a decorator"""</span></span>
<span id="cb846-4"><a href="writing-functions-in-python.html#cb846-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> decorator(func):</span>
<span id="cb846-5"><a href="writing-functions-in-python.html#cb846-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> wrapper(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb846-6"><a href="writing-functions-in-python.html#cb846-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb846-7"><a href="writing-functions-in-python.html#cb846-7" aria-hidden="true" tabindex="-1"></a>        func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb846-8"><a href="writing-functions-in-python.html#cb846-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> wrapper</span>
<span id="cb846-9"><a href="writing-functions-in-python.html#cb846-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> decorator</span>
<span id="cb846-10"><a href="writing-functions-in-python.html#cb846-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb846-11"><a href="writing-functions-in-python.html#cb846-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Make print_sum() run 10 times with the run_n_times() decorator</span></span>
<span id="cb846-12"><a href="writing-functions-in-python.html#cb846-12" aria-hidden="true" tabindex="-1"></a><span class="at">@run_n_times</span>(<span class="dv">10</span>)</span>
<span id="cb846-13"><a href="writing-functions-in-python.html#cb846-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_sum(a, b):</span>
<span id="cb846-14"><a href="writing-functions-in-python.html#cb846-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(a <span class="op">+</span> b)</span>
<span id="cb846-15"><a href="writing-functions-in-python.html#cb846-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb846-16"><a href="writing-functions-in-python.html#cb846-16" aria-hidden="true" tabindex="-1"></a>print_sum(<span class="dv">15</span>, <span class="dv">20</span>)</span></code></pre></div>
<pre><code>## 35
## 35
## 35
## 35
## 35
## 35
## 35
## 35
## 35
## 35</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Use <code>run_n_times()</code> to create a decorator <code>run_five_times()</code> that will run any function five times.
</p>
</div>
<div>
<div class="sourceCode" id="cb848"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb848-1"><a href="writing-functions-in-python.html#cb848-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use run_n_times() to create the run_five_times() decorator</span></span>
<span id="cb848-2"><a href="writing-functions-in-python.html#cb848-2" aria-hidden="true" tabindex="-1"></a>run_five_times <span class="op">=</span> run_n_times(<span class="dv">5</span>)</span>
<span id="cb848-3"><a href="writing-functions-in-python.html#cb848-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb848-4"><a href="writing-functions-in-python.html#cb848-4" aria-hidden="true" tabindex="-1"></a><span class="at">@run_five_times</span></span>
<span id="cb848-5"><a href="writing-functions-in-python.html#cb848-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_sum(a, b):</span>
<span id="cb848-6"><a href="writing-functions-in-python.html#cb848-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(a <span class="op">+</span> b)</span>
<span id="cb848-7"><a href="writing-functions-in-python.html#cb848-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb848-8"><a href="writing-functions-in-python.html#cb848-8" aria-hidden="true" tabindex="-1"></a>print_sum(<span class="dv">4</span>, <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## 104
## 104
## 104
## 104
## 104</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Here’s the prank: use <code>run_n_times()</code> to modify the built-in <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> function so that it always prints 20 times!
</p>
</div>
<div>
<div class="sourceCode" id="cb850"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb850-1"><a href="writing-functions-in-python.html#cb850-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify the print() function to always run 20 times</span></span>
<span id="cb850-2"><a href="writing-functions-in-python.html#cb850-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="op">=</span> run_n_times(<span class="dv">20</span>)(<span class="bu">print</span>)</span>
<span id="cb850-3"><a href="writing-functions-in-python.html#cb850-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb850-4"><a href="writing-functions-in-python.html#cb850-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'What is happening?!?!'</span>)</span></code></pre></div>
<pre><code>## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!
## What is happening?!?!</code></pre>
</div>
<p class>
Good job!<br>Good job!<br>Good job!<br><br>You’ve become an expert at using decorators. Notice how when you use decorator syntax for a decorator that takes arguments, you need to call the decorator by adding parentheses, but you don’t add parenthesis for decorators that don’t take arguments.<br><br><em>Warning: overwriting commonly used functions is probably not a great idea, so think twice before using these powers for evil.</em>
</p>
</div>
<div id="html-generator" class="section level4 unnumbered">
<h4>HTML Generator<a class="anchor" aria-label="anchor" href="#html-generator"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
You are writing a script that generates HTML for a webpage on the fly. So far, you have written two decorators that will add bold or italics tags to any function that returns a string. You notice, however, that these two decorators look very similar. Instead of writing a bunch of other similar looking decorators, you want to create one decorator, <code>html()</code>, that can take any pair of opening and closing tags.
</p>
<pre><code>def bold(func):
  @wraps(func)
  def wrapper(*args, **kwargs):
    msg = func(*args, **kwargs)
    return '&lt;b&gt;{}&lt;/b&gt;'.format(msg)
  return wrapper
</code></pre>
<pre><code>def italics(func):
  @wraps(func)
  def wrapper(*args, **kwargs):
    msg = func(*args, **kwargs)
    return '&lt;i&gt;{}&lt;/i&gt;'.format(msg)
  return wrapper
</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Return the decorator and the decorated function from the correct places in the new <code>html()</code> decorator.
</p>
</div>
<div>
<div class="sourceCode" id="cb852"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb852-1"><a href="writing-functions-in-python.html#cb852-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> html(open_tag, close_tag):</span>
<span id="cb852-2"><a href="writing-functions-in-python.html#cb852-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> decorator(func):</span>
<span id="cb852-3"><a href="writing-functions-in-python.html#cb852-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@wraps</span>(func)</span>
<span id="cb852-4"><a href="writing-functions-in-python.html#cb852-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> wrapper(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb852-5"><a href="writing-functions-in-python.html#cb852-5" aria-hidden="true" tabindex="-1"></a>      msg <span class="op">=</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb852-6"><a href="writing-functions-in-python.html#cb852-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="st">'</span><span class="sc">{}{}{}</span><span class="st">'</span>.<span class="bu">format</span>(open_tag, msg, close_tag)</span>
<span id="cb852-7"><a href="writing-functions-in-python.html#cb852-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the decorated function</span></span>
<span id="cb852-8"><a href="writing-functions-in-python.html#cb852-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> wrapper</span>
<span id="cb852-9"><a href="writing-functions-in-python.html#cb852-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the decorator</span></span>
<span id="cb852-10"><a href="writing-functions-in-python.html#cb852-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> decorator</span></code></pre></div>
</div>
<div class="exercise--instructions__content">
<p>
Use the <code>html()</code> decorator to wrap the return value of <code>hello()</code> in the strings <code>&lt;b&gt;</code> and <code>&lt;/b&gt;</code> (the HTML tags that mean “bold”).
</p>
</div>
<div>
<div class="sourceCode" id="cb853"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb853-1"><a href="writing-functions-in-python.html#cb853-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make hello() return bolded text</span></span>
<span id="cb853-2"><a href="writing-functions-in-python.html#cb853-2" aria-hidden="true" tabindex="-1"></a><span class="at">@html</span>(<span class="st">'&lt;b&gt;'</span>, <span class="st">'&lt;/b&gt;'</span>)</span>
<span id="cb853-3"><a href="writing-functions-in-python.html#cb853-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hello(name):</span>
<span id="cb853-4"><a href="writing-functions-in-python.html#cb853-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">'Hello </span><span class="sc">{}</span><span class="st">!'</span>.<span class="bu">format</span>(name)</span>
<span id="cb853-5"><a href="writing-functions-in-python.html#cb853-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb853-6"><a href="writing-functions-in-python.html#cb853-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(hello(<span class="st">'Alice'</span>))</span></code></pre></div>
<pre><code>## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Use <code>html()</code> to wrap the return value of <code>goodbye()</code> in the strings <code>&lt;i&gt;</code> and <code>&lt;/i&gt;</code> (the HTML tags that mean “italics”).
</p>
</div>
<div>
<div class="sourceCode" id="cb855"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb855-1"><a href="writing-functions-in-python.html#cb855-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make goodbye() return italicized text</span></span>
<span id="cb855-2"><a href="writing-functions-in-python.html#cb855-2" aria-hidden="true" tabindex="-1"></a><span class="at">@html</span>(<span class="st">'&lt;i&gt;'</span>, <span class="st">'&lt;/i&gt;'</span>)</span>
<span id="cb855-3"><a href="writing-functions-in-python.html#cb855-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> goodbye(name):</span>
<span id="cb855-4"><a href="writing-functions-in-python.html#cb855-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">'Goodbye </span><span class="sc">{}</span><span class="st">.'</span>.<span class="bu">format</span>(name)</span>
<span id="cb855-5"><a href="writing-functions-in-python.html#cb855-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb855-6"><a href="writing-functions-in-python.html#cb855-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(goodbye(<span class="st">'Alice'</span>))</span></code></pre></div>
<pre><code>## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;</code></pre>
</div>
<div class="exercise--instructions__content">
<p>
Use <code>html()</code> to wrap <code>hello_goodbye()</code> in a DIV, which is done by adding the strings <code>&lt;div&gt;</code> and <code>&lt;/div&gt;</code> tags around a string.
</p>
</div>
<div>
<div class="sourceCode" id="cb857"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb857-1"><a href="writing-functions-in-python.html#cb857-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrap the result of hello_goodbye() in &lt;div&gt; and &lt;/div&gt;</span></span>
<span id="cb857-2"><a href="writing-functions-in-python.html#cb857-2" aria-hidden="true" tabindex="-1"></a><span class="at">@html</span>(<span class="st">'&lt;div&gt;'</span>, <span class="st">'&lt;/div&gt;'</span>)</span>
<span id="cb857-3"><a href="writing-functions-in-python.html#cb857-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hello_goodbye(name):</span>
<span id="cb857-4"><a href="writing-functions-in-python.html#cb857-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">'</span><span class="ch">\n</span><span class="sc">{}</span><span class="ch">\n</span><span class="sc">{}</span><span class="ch">\n</span><span class="st">'</span>.<span class="bu">format</span>(hello(name), goodbye(name))</span>
<span id="cb857-5"><a href="writing-functions-in-python.html#cb857-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb857-6"><a href="writing-functions-in-python.html#cb857-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(hello_goodbye(<span class="st">'Alice'</span>))</span></code></pre></div>
<pre><code>## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;
## &lt;div&gt;
## &lt;b&gt;Hello Alice!&lt;/b&gt;
## &lt;i&gt;Goodbye Alice.&lt;/i&gt;
## &lt;/div&gt;</code></pre>
</div>
<p class>
That’s some HTML hotness! With the new <code>html()</code> decorator you can focus on writing simple functions that return the information you want to display on the webpage and let the decorator take care of wrapping them in the appropriate HTML tags.
</p>
</div>
</div>
<div id="timeout-a-real-world-example" class="section level3 unnumbered">
<h3>Timeout(): a real world example<a class="anchor" aria-label="anchor" href="#timeout-a-real-world-example"><i class="fas fa-link"></i></a>
</h3>
<div id="tag-your-functions" class="section level4 unnumbered">
<h4>Tag your functions<a class="anchor" aria-label="anchor" href="#tag-your-functions"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
Tagging something means that you have given that thing one or more strings that act as labels. For instance, we often tag emails or photos so that we can search for them later. You’ve decided to write a decorator that will let you tag your functions with an arbitrary list of tags. You could use these tags for many things:
</p>
<ul>
<li>
Adding information about who has worked on the function, so a user can look up who to ask if they run into trouble using it.
</li>
<li>
Labeling functions as “experimental” so that users know that the inputs and outputs might change in the future.
</li>
<li>
Marking any functions that you plan to remove in a future version of the code.
</li>
<li>
Etc.
</li>
</ul>
</div>
<li>
Define a new decorator, named <code>decorator()</code>, to return.
</li>
<li>
Ensure the decorated function keeps its metadata.
</li>
<li>
Call the function being decorated and return the result.
</li>
<li>
Return the new decorator.
</li>
<div>
<div class="sourceCode" id="cb859"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb859-1"><a href="writing-functions-in-python.html#cb859-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tag(<span class="op">*</span>tags):</span>
<span id="cb859-2"><a href="writing-functions-in-python.html#cb859-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define a new decorator, named "decorator", to return</span></span>
<span id="cb859-3"><a href="writing-functions-in-python.html#cb859-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> decorator(func):</span>
<span id="cb859-4"><a href="writing-functions-in-python.html#cb859-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure the decorated function keeps its metadata</span></span>
<span id="cb859-5"><a href="writing-functions-in-python.html#cb859-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">@wraps</span>(func)</span>
<span id="cb859-6"><a href="writing-functions-in-python.html#cb859-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> wrapper(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb859-7"><a href="writing-functions-in-python.html#cb859-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Call the function being decorated and return the result</span></span>
<span id="cb859-8"><a href="writing-functions-in-python.html#cb859-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb859-9"><a href="writing-functions-in-python.html#cb859-9" aria-hidden="true" tabindex="-1"></a>    wrapper.tags <span class="op">=</span> tags</span>
<span id="cb859-10"><a href="writing-functions-in-python.html#cb859-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> wrapper</span>
<span id="cb859-11"><a href="writing-functions-in-python.html#cb859-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the new decorator</span></span>
<span id="cb859-12"><a href="writing-functions-in-python.html#cb859-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> decorator</span>
<span id="cb859-13"><a href="writing-functions-in-python.html#cb859-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb859-14"><a href="writing-functions-in-python.html#cb859-14" aria-hidden="true" tabindex="-1"></a><span class="at">@tag</span>(<span class="st">'test'</span>, <span class="st">'this is a tag'</span>)</span>
<span id="cb859-15"><a href="writing-functions-in-python.html#cb859-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo():</span>
<span id="cb859-16"><a href="writing-functions-in-python.html#cb859-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">pass</span></span>
<span id="cb859-17"><a href="writing-functions-in-python.html#cb859-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb859-18"><a href="writing-functions-in-python.html#cb859-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(foo.tags)</span></code></pre></div>
<pre><code>## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')
## ('test', 'this is a tag')</code></pre>
</div>
<p class>
Terrific tagging! With this new decorator, you can do some really interesting things. For instance, you could tag a bunch of image transforming functions, and then write code that searches for all of the functions that transform images and apply them, one after the other, on a given input image. What other neat uses can you come up with for this decorator?
</p>
</div>
<div id="check-the-return-type" class="section level4 unnumbered">
<h4>Check the return type<a class="anchor" aria-label="anchor" href="#check-the-return-type"><i class="fas fa-link"></i></a>
</h4>
<div>
<p>
Python’s flexibility around data types is usually cited as one of the benefits of the language. It can sometimes cause problems though if incorrect data types go unnoticed. You’ve decided that in order to ensure your code is doing exactly what you want it to do, you will explicitly check the return types in all of your functions and make sure they’re returning what you expect. To do that, you are going to create a decorator that checks if the return type of the decorated function is correct.
</p>
<p>
<em>Note</em>: <code>assert</code> is a keyword that you can use to test whether something is true. If you type <code>assert condition</code> and <code>condition</code> is <code>True</code>, this function doesn’t do anything. If <code>condition</code> is <code>False</code>, this function raises an error. The type of error that it raises is called an <code>AssertionError</code>.
</p>
</div>
<li>
Start by completing the <code>returns_dict()</code> decorator so that it raises an <code>AssertionError</code> if the return type of the decorated function is not a dictionary.
</li>
<div>
<div class="sourceCode" id="cb861"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb861-1"><a href="writing-functions-in-python.html#cb861-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> returns_dict(func):</span>
<span id="cb861-2"><a href="writing-functions-in-python.html#cb861-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Complete the returns_dict() decorator</span></span>
<span id="cb861-3"><a href="writing-functions-in-python.html#cb861-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> wrapper(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb861-4"><a href="writing-functions-in-python.html#cb861-4" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb861-5"><a href="writing-functions-in-python.html#cb861-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">type</span>(result) <span class="op">==</span> <span class="bu">dict</span></span>
<span id="cb861-6"><a href="writing-functions-in-python.html#cb861-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb861-7"><a href="writing-functions-in-python.html#cb861-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper</span>
<span id="cb861-8"><a href="writing-functions-in-python.html#cb861-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb861-9"><a href="writing-functions-in-python.html#cb861-9" aria-hidden="true" tabindex="-1"></a><span class="at">@returns_dict</span></span>
<span id="cb861-10"><a href="writing-functions-in-python.html#cb861-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(value):</span>
<span id="cb861-11"><a href="writing-functions-in-python.html#cb861-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> value</span>
<span id="cb861-12"><a href="writing-functions-in-python.html#cb861-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb861-13"><a href="writing-functions-in-python.html#cb861-13" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb861-14"><a href="writing-functions-in-python.html#cb861-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(foo([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]))</span>
<span id="cb861-15"><a href="writing-functions-in-python.html#cb861-15" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">AssertionError</span>:</span>
<span id="cb861-16"><a href="writing-functions-in-python.html#cb861-16" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'foo() did not return a dict!'</span>)</span></code></pre></div>
<pre><code>## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!</code></pre>
</div>
<li>
Now complete the <code>returns()</code> decorator, which takes the expected return type as an argument.
</li>
<div>
<div class="sourceCode" id="cb863"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb863-1"><a href="writing-functions-in-python.html#cb863-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> returns(return_type):</span>
<span id="cb863-2"><a href="writing-functions-in-python.html#cb863-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Write a decorator that raises an AssertionError if the</span></span>
<span id="cb863-3"><a href="writing-functions-in-python.html#cb863-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># decorated function returns a value that is not return_type</span></span>
<span id="cb863-4"><a href="writing-functions-in-python.html#cb863-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> decorator(func):</span>
<span id="cb863-5"><a href="writing-functions-in-python.html#cb863-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> wrapper(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb863-6"><a href="writing-functions-in-python.html#cb863-6" aria-hidden="true" tabindex="-1"></a>      result <span class="op">=</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb863-7"><a href="writing-functions-in-python.html#cb863-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">assert</span> <span class="bu">type</span>(result) <span class="op">==</span> return_type</span>
<span id="cb863-8"><a href="writing-functions-in-python.html#cb863-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> result</span>
<span id="cb863-9"><a href="writing-functions-in-python.html#cb863-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> wrapper</span>
<span id="cb863-10"><a href="writing-functions-in-python.html#cb863-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> decorator</span>
<span id="cb863-11"><a href="writing-functions-in-python.html#cb863-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb863-12"><a href="writing-functions-in-python.html#cb863-12" aria-hidden="true" tabindex="-1"></a><span class="at">@returns</span>(<span class="bu">dict</span>)</span>
<span id="cb863-13"><a href="writing-functions-in-python.html#cb863-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> foo(value):</span>
<span id="cb863-14"><a href="writing-functions-in-python.html#cb863-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> value</span>
<span id="cb863-15"><a href="writing-functions-in-python.html#cb863-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-16"><a href="writing-functions-in-python.html#cb863-16" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb863-17"><a href="writing-functions-in-python.html#cb863-17" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(foo([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]))</span>
<span id="cb863-18"><a href="writing-functions-in-python.html#cb863-18" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">AssertionError</span>:</span>
<span id="cb863-19"><a href="writing-functions-in-python.html#cb863-19" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'foo() did not return a dict!'</span>)</span></code></pre></div>
<pre><code>## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!
## foo() did not return a dict!</code></pre>
</div>
<p class>
You did it! We took the training wheels off on this exercise, and you still did a great job. You know how to write your own decorators now, but even more importantly, you know why they work the way they do.
</p>
</div>
</div>
<div id="great-job" class="section level3 unnumbered">
<h3>Great job!<a class="anchor" aria-label="anchor" href="#great-job"><i class="fas fa-link"></i></a>
</h3>
<div id="great-job-1" class="section level4 unnumbered">
<h4>Great job!<a class="anchor" aria-label="anchor" href="#great-job-1"><i class="fas fa-link"></i></a>
</h4>
<p>Great job! You’ve covered a lot in this course.</p>
</div>
<div id="chapter-1---best-practices" class="section level4 unnumbered">
<h4>Chapter 1 - Best Practices<a class="anchor" aria-label="anchor" href="#chapter-1---best-practices"><i class="fas fa-link"></i></a>
</h4>
<p>In the first chapter, you learned how to make high-quality functions by giving them docstrings and by making sure that they only do one thing. Remembering the acronym DRY, or “Don’t Repeat Yourself”, helped you notice when you needed to pull part of your code into a reusable function. You also learned about how Python passes arguments to functions and the difference between mutable and immutable variables.</p>
</div>
<div id="chapter-2---context-managers" class="section level4 unnumbered">
<h4>Chapter 2 - Context Managers<a class="anchor" aria-label="anchor" href="#chapter-2---context-managers"><i class="fas fa-link"></i></a>
</h4>
<p>In the chapter on context managers, you learned how to use the keyword “with” to enter and then exit a context. You also learned how to write your own context managers by using the contextmanager() decorator.</p>
</div>
<div id="chapter-3---decorators" class="section level4 unnumbered">
<h4>Chapter 3 - Decorators<a class="anchor" aria-label="anchor" href="#chapter-3---decorators"><i class="fas fa-link"></i></a>
</h4>
<p>You also spent a lot of time in this course understanding decorators: how they work, how to use them, and how to write decorators of your own.</p>
</div>
<div id="chapter-4---more-on-decorators" class="section level4 unnumbered">
<h4>Chapter 4 - More on Decorators<a class="anchor" aria-label="anchor" href="#chapter-4---more-on-decorators"><i class="fas fa-link"></i></a>
</h4>
<p>Finally, in chapter 4, you learned how to use functools.wraps() to make sure your decorated functions maintain their metadata.</p>
</div>
<div id="chapter-4---more-on-decorators-1" class="section level4 unnumbered">
<h4>Chapter 4 - More on Decorators<a class="anchor" aria-label="anchor" href="#chapter-4---more-on-decorators-1"><i class="fas fa-link"></i></a>
</h4>
<p>And you learned how to write decorators that take arguments.</p>
</div>
<div id="thank-you" class="section level4 unnumbered">
<h4>Thank you!<a class="anchor" aria-label="anchor" href="#thank-you"><i class="fas fa-link"></i></a>
</h4>
<p>It has been an honor to spend this time with you. I wanted to let you know that I’ll be donating a portion of the proceeds from this course to WiMLDS, a non-profit that helps support and promote women in the fields of machine learning and data science. I’ll be looking forward to hearing about all of the amazing things you do with Python in the future!</p>

</div>
</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="writing-efficient-python-code.html">Writing Efficient Python Code</a></div>
<div class="next"><a href="object-oriented-programming-in-python.html">Object-Oriented Programming in Python</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#writing-functions-in-python">Writing Functions in Python</a></li>
<li>
<a class="nav-link" href="#best-practices">Best Practices</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#docstrings">Docstrings</a></li>
<li><a class="nav-link" href="#dry-and-do-one-thing">DRY and "Do One Thing"</a></li>
<li><a class="nav-link" href="#pass-by-assignment">Pass by assignment</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#context-managers">Context Managers</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#using-context-managers">Using context managers</a></li>
<li><a class="nav-link" href="#writing-context-managers">Writing context managers</a></li>
<li><a class="nav-link" href="#advanced-topics">Advanced topics</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#decorators">Decorators</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#functions-are-objects">Functions are objects</a></li>
<li><a class="nav-link" href="#scope">Scope</a></li>
<li><a class="nav-link" href="#closures">Closures</a></li>
<li><a class="nav-link" href="#decorators-1">Decorators</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#more-on-decorators">More on Decorators</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#real-world-examples">Real-world examples</a></li>
<li><a class="nav-link" href="#decorators-and-metadata">Decorators and metadata</a></li>
<li><a class="nav-link" href="#decorators-that-take-arguments">Decorators that take arguments</a></li>
<li><a class="nav-link" href="#timeout-a-real-world-example">Timeout(): a real world example</a></li>
<li><a class="nav-link" href="#great-job">Great job!</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mcllix85/https://github.com/mclix85/python-fundamentals/blob/master/Writing-Functions-in-Python.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mcllix85/https://github.com/mclix85/python-fundamentals/edit/master/Writing-Functions-in-Python.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Python Fundamenals</strong>" was written by Dat Tran. It was last built on 2023-01-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
